/*!
 * @author 김승일
 * @email comahead@vi-nyl.com
 * @description 멜론 프레임웍
 */
(function(d,b,c,e){var a=b.Class,g=d(window),f=d(document);
/*!
	 * @author 강태진
	 * @email odyseek@vi-nyl.com
	 * @description 커버이미지 설정 관련
	 */
;b.define("WEBSVC.MyMusic.CoverImage",function(){var h=a({name:"CoverImage",$extend:MELON.PBPGN.View,defaults:{target:{},width:0,height:0,observer:false,startX:0,startY:0,prevX:0,prevY:0,checkTime:"",uploadResult:[],success:{},path:"",imgScroll:true},initialize:function(j,i){var k=this,l=null;if(k.supr(j,i)===false){return}l=k.$el;k.width=k.options.width;k.height=k.options.height;k.maxHeight=l.height()-k.height;l.css({"background-image":"url('"+k.options.path+"')","background-position":"0px 0px"});l.mousedown(function(m){k.getPosition();k.prevX=m.screenX;k.prevY=m.screenY;l.css({cursor:"n-resize"});if(k.imgScroll){k.observer=true}else{k.observer=false}});l.mousemove(function(n){if(!k.observer){return false}var m=0;var o=k.startY-(k.prevY-n.screenY);if(k.maxHeight>o){o=k.maxHeight}else{if(o>0){o=0}}d(this).css({"background-position":(m+"px "+o+"px")})});d("body").mouseup(function(m){l.css({cursor:""});k.getPosition();k.observer=false})},getPosition:function(){var i=this,j=this.$el;if(j.css("background-position")===e){var k=[];k[0]=j.css("background-position-x");k[1]=j.css("background-position-y")}else{var k=j.css("background-position").split(" ")}i.startX=parseInt(k[0]);i.startY=parseInt(k[1])},disableSelection:function(){var i=this,j=this.$el;if(typeof this.target.onselectstart!=="undefined"){this.target.onselectstart=function(){return false}}else{if(typeof this.target.style.MozUserSelect!=="undefined"){this.target.style.MozUserSelect="none"}}},positionY:function(){var i=this,j=i.$el;if(j.css("background-position")===e){var k=[];k[0]=j.css("background-position-x");k[1]=j.css("background-position-y")}else{var k=j.css("background-position").split(" ")}return k[1]},update:function(j){var i=this,k=this.$el;i.path=j.path;i.height=j.height;i.maxHeight=k.height()-i.height;d('<img src="'+i.path+'" alt="">').prependTo(k).hide();k.find("img").load(function(){if(228>k.find("img").height()){i.imgScroll=false;i.height=k.find("img").height();i.maxHeight=k.height()-i.height;d("#mypageImgCoverHeight").val(i.height)}else{i.imgScroll=true;if(i.height>k.find("img").height()){i.height=k.find("img").height();i.maxHeight=k.height()-i.height;d("#mypageImgCoverHeight").val(i.height)}}k.find("img").remove()});k.css({"background-image":"url('"+i.path+"')","background-position":"0px 0px"})}});b.bindjQuery(h,"coverImage");return h});c.MonthCalendar.prototype.defaults.getTitle=function(i,h,j){switch(i){case"active":return j+"월"+this.options.title;case"normal":return j+"월 "+this.options.title+" - 페이지 이동";case"before":case"after":return"(집계된 데이타가 없습니다.)"}return""};b.define("WEBSVC.MyMusic",function(){SEND_USER_NAME:"";MEMBERKEY:"";TARGET_USER_MKEY:"";GIFT_NO:"";PROD_ID:"";PRESENT_GBN:"";return{checkGift:function(n){var h=b.MyMusic.SEND_USER_NAME;var l=b.MyMusic.MEMBERKEY;var m=b.MyMusic.TARGET_USER_MKEY;var j=b.MyMusic.GIFT_NO;var k=b.MyMusic.PROD_ID;var i=b.MyMusic.PRESENT_GBN;d.ajax({url:"/mymusic/messagepresent/popup/mymusicpresent_receivePopup.htm",data:{giftNo:j}}).done(function(p){var o=d(p.replace(/\n|\r/g,"")).appendTo("body");d("#nickName").text(h);o.modal({clone:false,removeOnClose:true,on:{created:function(){if(o.data("inited")===true){return}o.data("inited",true);var q=o.find(".gift_answr");o.find("select").on("change",function(){q.parent()[this.value==="input"?"show":"hide"]();o.modal("center")});q.textControl({counting:true,countType:"char",limit:160,limitTarget:".text_size"})},ok:function(){var q="";var s=d("#gift2 option:selected").val();if(d("#gift2 option:selected").val()=="input"){q=d("#d_message").val()}else{q=d("#gift2 option:selected").text()}if(q.length<1){alert("메시지를 입력해 주세요.");return false}var r=false;if(q.length>0){d.ajax({type:"POST",url:"/mymusic/common/mymusiccommon_checkRestrictWord.json",async:false,data:{inputStr:encodeURIComponent(q)},success:function(t){if(t.result==true){alert("작성하신 글 중 "+t.message+"은 금칙어 입니다. 수정 후 등록해주세요.");r=true}}});if(r){return false}}d.get("/mymusic/messagepresent/popup/mymusicpresent_insertReceivePopup.json",{mesgCont:q,memberkey:l,targetMemberKeys:m,giftNo:j,chkOpt:s},function(t){}).done(function(t){if(t.msgChk==-501){alert("작성하신 글 중 "+t.message+"은 금칙어 입니다. 수정 후 등록해주세요.");return false}if(t.RESULT=="1"){alert("메시지가 친구에게 전달 되었습니다.");if(i==0){location.href="/mymusic/messagepresent/mymusicpresent_receiveDetailTiket.htm?memberkey="+l+"&giftNo="+j+"&prodId="+k+"&listType=receiveTab&cancelChk=Y"}else{location.href="/mymusic/messagepresent/mymusicpresent_receiveDetailSongList.htm?memberkey="+l+"&giftNo="+j+"&listType=receiveTab&cancelChk=Y"}}else{alert("메시지 전달 실패하였습니다.");if(i==0){location.href="/mymusic/messagepresent/mymusicpresent_receiveDetailTiket.htm?memberkey="+l+"&giftNo="+j+"&prodId="+k+"&listType=receiveTab&cancelChk=Y"}else{location.href="/mymusic/messagepresent/mymusicpresent_receiveDetailSongList.htm?memberkey="+l+"&giftNo="+j+"&listType=receiveTab&cancelChk=Y"}}})},cancel:function(){if(i==0){location.href="/mymusic/messagepresent/mymusicpresent_receiveDetailTiket.htm?memberkey="+l+"&giftNo="+j+"&prodId="+k+"&listType=receiveTab&cancelChk=Y"}else{location.href="/mymusic/messagepresent/mymusicpresent_receiveDetailSongList.htm?memberkey="+l+"&giftNo="+j+"&listType=receiveTab&cancelChk=Y"}}}});d("select.d_selectbox").selectbox()})}}});b.define("WEBSVC.MyMusic.SendSongMessage",function(){var h="mymusic/friend/mymusicfriend_listFriend.htm";return{init:function(){(function(){var j=d("#d_btn_emo"),k=d("#d_layer_emo"),i=d("#d_hidden_emo");k.on("click","button",function(m){var l=d(this);j.html(l.html()).attr("title",l.attr("title"))[0].className=this.className;i.val(l.attr("data-value"));k.hideLayer()})}());d("#d_message").textControl({counting:true,limit:80,limitTarget:"#d_text_count"});(function(){var t=d("#d_music_tab").tabs({type:"parent-on"}),q=b.template(d("#d_song_row").html()),s=["recent","like","search"],j=s[t.find(">li.on").index()<0?0:t.find(">li.on").index()],k=d("#d_kwd"),m=t.find("li.on tbody"),l=d("#d_right_list tbody"),r=false,i={recent:0,like:0,search:0};function o(w){var x=w.find("input:checkbox").val();if(l.find("input:checkbox[value="+x+"]").length>0){return}if(l.find("tr.d_added").length>=10){alert("최대 10곡까지 추가할 수 있습니다.");return false}var u=w.closest("tr").clone().removeClass("active").addClass("d_added"),v=u.find("td");v.eq(0).find("input:checkbox").prop("checked",false);v.eq(2).find("div.d_layer").hideLayer().find("span[class^=bullet]").attr("class","bullet_vertical");v.eq(3).remove();v.eq(4).find("button").attr("title",function(){return(this.title||"").replace(/추가$/,"삭제")}).replaceClass("add_music","delt_music").children().text("삭제");l.append(u).trigger("addedlistchanged",["added",u])}function n(u){u.remove();l.trigger("addedlistchanged",["removed"])}function p(v){if(r){return}if(j==="search"&&k.trimVal()===""){alert("검색어를 입력해주세요.");k.focus();return}var u="",w={};switch(j){case"recent":u=t.find("li.list1>a").attr("href");break;case"like":u=t.find("li.list2 div.song_sort a.on").attr("href");break;case"search":u=t.find("li.list3 div.song_sort a.on").attr("href");break}r=true;if(v){w.lastId=i[j]}if(j==="search"){w.kwd=k.trimVal()}d.ajax({url:u,data:w,dataType:"json"}).done(function(z){if(z.result){if(!v){m.empty();if(z.data.length===0){m.find("tr.d_no_rows").show()}else{m.find("tr.d_no_rows").hide()}}i[j]=z.lastId;for(var y=0,x=z.data.length;y<x;y++){if(j==="search"){z.data[y].highlightTitle=(z.data[y].title||"").replace(w.kwd,"<em>"+w.kwd+"</em>")}else{z.data[y].highlightTitle=z.data[y].title}m.append(q(z.data[y]))}}}).fail(function(){}).always(function(){r=false})}d("div.chic_music_cont").on("click","tbody input:checkbox",function(v){v.stopPropagation();var u=d(this);u.trigger("changed")}).on("changed","div.song_list tbody input:checkbox",function(v){var u=d(this);u.closest("tr")[u.prop("checked")?"addClass":"removeClass"]("active")});t.on("selected",function(v,u){switch(u){case 0:j="recent";break;case 1:j="like";break;case 2:j="search";break}m=d("#d_music_tab li.on tbody");if(u<2){p()}});k.on("keyup",function(u){if(u.keyCode===13){d("#d_btn_search").triggerHandler("click")}});d("#d_btn_search").on("click",function(){d(this).closest("div.song_wrap").find("div.song_sort a.on").click()});d("ul.frend_list").on("click","li>button",function(){if(d(this).closest("ul").find("li").length===1){d("p.frend_ynlk.d_nofriend").show();d("ul.frend_list").hide()}d(this).closest("li").remove()});d("#d_btn_gift").on("click",function(){window.open(h,"","app_,width=816,height=640, scrollbars=no")});d("div.chic_music_cont").on("click","button.add_music:not(.disabled), button.delt_music:not(.disabled)",function(){var u=d(this);if(u.hasClass("add_music")){o(u.closest("tr"))}else{n(u.closest("tr"))}});d("div.chic_music_cont").on("click","button.d_move_right",function(){var u=m.find("input:checkbox:checked");if(u.length===0){alert("선택된 항목이 없습니다.");return}u.each(function(){if(o(d(this).closest("tr"))===false){return false}})});d("div.chic_music_cont").on("click","button.d_remove_right",function(){var u=l.find("input:checkbox:checked");if(u.length===0){alert("선택된 항목이 없습니다.");return}u.each(function(){n(d(this).closest("tr"))})});d("div.view_more button.top").on("click",function(){d(this).closest("div.song_wrap").find("div.song_list").animate({scrollTop:0},"fast")});d("button.d_get_more").on("click",function(){p(true)});t.on("click","div.song_sort a",function(u){u.preventDefault();if(j==="search"&&k.trimVal()===""){alert("검색어를 입력해주세요.");k.focus();return}d(this).siblings().removeClass("on").end().addClass("on");p()});l.on("addedlistchanged",function(){var u=l.find("tr.d_added").length;d("#d_added_count").html(u);if(u>0){l.find("tr.d_no_rows").hide()}else{l.find("tr.d_no_rows").show()}});p()})()},initFriend:function(){var j="friends",p=false,u=d("#d_added_friends tbody"),k=d("#d_kwd"),t=d("#d_tab"),o=b.template(d("#d_friend_row").html()),n=b.template(d("#d_search_row").html()),i={friend:0,search:0};function q(){return d("#d_tab li.on tbody")}function l(v){return u.find("input:checkbox[value="+v+"]").length>0}function s(z){var y=0;if((y=u.find("tr.d_added").length)>=10){alert("최대 10까지 선택하실 수 있습니다.");return false}var A=z.find("input:checkbox").val(),x;if(l(A)){return}var w=z.find("input.d_name").val(),v=d(['<tr class="d_added"><td class="t_center"><div class="wrap"><input type="checkbox" value="'+A+'" title="'+w+' 선택" /></div>','</td><td><div class="wrap">'+z.find("a.user_image").html(),'<span class="user_nicnm" title="'+w+'"><a href="member.do?id='+A+'" title="'+w+' - 새창" target="_blank">'+w+"</a></span>",'</div></td><td class="t_center"><div class="wrap">','<button type="button" class="delt_music" title="'+w+' - 삭제"><span>삭제</span></button>',"</div></td></tr>"].join(""));u.append(v).trigger("addedlistchanged",["added",v])}function m(v){v.remove();u.trigger("addedlistchanged",["removed"])}function r(w){if(p){return}var x={},v="";if(j==="search"){if(k.trimVal()===""){alert("검색어를 입력해주세요.");k.focus();return}v=t.find("div.song_sort a.on").attr("href");x.kwd=k.trimVal()}else{v=t.find(">li.list1>a").attr("href")}if(w){x.lastId=i[j]}p=true;d.ajax({url:v,data:x,method:"post",dataType:"json"}).done(function(B){if(!B.result){alert(B.errorMessage);return}var z=q();z.find("tr.data_ynlk").hide();if(!w){z.empty()}i[j]=B.lastId;if(j==="search"){o=n}for(var A=0,y=B.data.length;A<y;A++){if(j==="search"){B.data[A].highlightNickName=(B.data[A].nickName||"").replace(x.kwd,"<em>"+x.kwd+"</em>")}z.append(o(B.data[A]))}}).fail(function(){}).always(function(){p=false})}t.tabs({type:"parent-on",onSelected:function(w,v){switch(v){case 0:j="friends";d("div.add_frend")[0].className="add_frend";r();break;case 1:j="search";d("div.add_frend")[0].className="add_frend frend_serch serch_data_ynlk";break}}});d("div.add_frend").on("click",".add_music:not(.disabled)",function(){s(d(this).closest("tr"))}).on("click",".delt_music",function(){m(d(this).closest("tr"))});d("div.view_more button.top").on("click",function(){d(this).closest("div.song_wrap").find("div.song_list").animate({scrollTop:0},"fast")});d("button.d_add_friends").on("click",function(){var v=q(),w=v.find("input:checkbox:checked");if(w.length===0){alert("선택된 항목이 없습니다.");return}w.each(function(){if(s(d(this).closest("tr"))===false){return false}})});d("button.d_delete_friends").on("click",function(){var v=u.find("input:checkbox:checked");if(v.length===0){alert("선택된 항목이 없습니다.");return}v.each(function(){m(d(this).closest("tr"))})});d("button.d_get_more").on("click",function(){r(true)});k.on("keyup",function(v){if(v.keyCode===13){d("button.d_btn_search").triggerHandler("click")}});d("button.d_btn_search").on("click",function(){d("#d_tab li.list2").find("div.song_sort a:eq(0)").triggerHandler("click")});d("#d_tab li.list2").find("div.song_sort a").on("click",function(v){v.preventDefault();if(j==="search"&&k.trimVal()===""){alert("검색어를 입력해주세요.");k.focus();return}d(this).activeRow("on");r()});d("#d_btn_add").on("click",function(){var w=u.find("tr.d_added");var v=opener.MELON.WEBSVC.MyMusic.SendSongMessage;w.each(function(){var y=d(this),z=y.find("input:checkbox").val(),x=y.find("span.user_nicnm").text();v.addFriend(z,x)});self.close()});d("div.add_frend_cont").on("click","tbody input:checkbox",function(w){var v=d(this);v.trigger("changed")}).on("changed","div.song_list tbody input:checkbox",function(w){w.stopPropagation();var v=d(this);v.closest("tr")[v.prop("checked")?"addClass":"removeClass"]("active")});u.on("addedlistchanged",function(y,w,x){var v=u.find("tr.d_added").length;if(v>0){u.find("tr.data_ynlk").hide()}else{u.find("tr.data_ynlk").show()}d("#d_added_friends_count em").html(v)});r()},addFriend:function(l,i){var k=d("ul.frend_list");if(k.find("input[value="+l+"]").length>0){return}d("p.frend_ynlk.d_nofriend").hide();d("ul.frend_list").show();var j='<li><span class="none">친구 닉네임</span><span class="frend_name" title="'+i+'"><input type="hidden" name="friend_no" value="'+l+'" />'+i+'</span><button type="button" title="'+i+' - 삭제"><span class="none">삭제</span><span></span></button></li>';k.append(d(j))}}});b.define("WEBSVC.Mypage.AddFriend",function(){return{init:function(){var D=this,w=d("div.add_frend"),r=d("#d_tab"),v=d("#d_added_count"),i=d("#d_added_table tbody"),C=r.find(">li.on"),o=C.find("tbody"),s=d("#d_kwd"),B=["recent","friend","search","mobile"],x=B[0],y=b.template(d("#d_friend_row").html()),m=b.template(d("#d_search_row").html()),z=false,h=b.array.include,u=[],j={recent:0,friend:0,search:0};function n(E){return i.find("input:checkbox[value="+E+"]").length>0}function l(I){var H=0;if((H=i.find("tr.d_added").length)>=10){alert("최대 10까지 선택하실 수 있습니다.");return false}var J=I.find("input:checkbox").val(),G;if(n(J)){return}var F=I.find("input.d_name").val(),E=d(['<tr class="d_added"><td class="t_center"><div class="wrap">','<input type="checkbox" value="'+J+'" title="'+F+' 선택" /></div>','</td><td><div class="wrap"><a href="member.do?id='+J+'" class="user_image" title="'+F+' 이미지">'+I.find("a.user_image").html()+"</a>\r\n",'<span class="user_nicnm" title="'+F+'"><a href="member.do?id='+J+'" title="'+F+' - 새창" target="_blank">'+F+"</a></span>",'</div></td><td class="t_center"><div class="wrap">','<button type="button" class="delt_music" title="'+F+' - 삭제"><span>삭제</span></button>',"</div></td></tr>"].join(""));p(I);i.append(E).trigger("addedlistchanged",["added",J,E])}function A(){if(i.find("tr.d_added").length>=10){alert("최대 10까지 선택하실 수 있습니다.");return false}var H=C.find("td.hp_insert"),F=H.find("input.d_mobile_no"),G=F.val();if(!/^(?:010|011|016|017|018|019)[\d]{7,8}$/.test(G)){alert("휴대폰 번호가 잘못 되었습니다.");F.focus();return}if(i.find("input:checkbox[value="+G+"]").length>0){alert("이미 추가된 번호입니다.");F.focus();return}var E=d(['<tr class="d_added"><td class="t_center"><div class="wrap">','<input type="checkbox" value="'+G+'" title="'+G+' 선택" /></div>','</td><td><div class="wrap"><span class="user_image">&nbsp;</span>\r\n','<span class="user_nicnm" title="'+G+'">'+G+"</span>",'</div></td><td class="t_center"><div class="wrap">','<button type="button" class="delt_music" title="'+G+' - 삭제"><span>삭제</span></button>',"</div></td></tr>"].join(""));i.append(E).trigger("addedlistchanged",["added",G.$row]);F.val("")}function q(E){var F=E.find("input:checkbox").val();E.remove();i.trigger("addedlistchanged",["removed",F])}function t(E){o.find("tr:not(.d_no_data)")[E?"noop":"remove"]();o.find("tr.d_no_data")[E?"hide":"show"]();C.find("button.more").prop("disabled",!E)[E?"removeClass":"addClass"]("disabled")}function k(F){if(z){return}var G={},E="";if(x==="search"){E=C.find("div.song_sort a.on").attr("href");G.kwd=s.trimVal()}else{E=C.find(">a").attr("href")}if(F){G.lastId=j[x]}else{o.find("tr:not(d_no_data)").remove()}z=true;setTimeout(function(){o.find("tr.d_waiting").show()},26);d.ajax({url:E,data:G,method:"post",dataType:"json"}).done(function(L){if(!L.result){alert(L.errorMessage);return}var J=y,I;if(L.data&&L.data.length){j[x]=L.lastId;t(true);if(x==="search"){J=m}for(var K=0,H=L.data.length;K<H;K++){if(x==="search"){L.data[K].highlightNickName=(L.data[K].nickName||"").replace(G.kwd,"<em>"+G.kwd+"</em>")}I=d(J(L.data[K]).replace(/\n|\r/g,""));if(h(u,L.data[K].memberId,false)){p(I)}o.append(I)}}else{t(false)}}).fail(function(){t(false)}).always(function(){o.find("tr.d_waiting").hide();z=false})}function p(F,E){}r.tabs({type:"parent-on",onSelected:function(F,E){x=B[E];C=r.find(">li.on");o=r.find(">li.on tbody");switch(E){case 0:case 1:k();break}}});w.on("click",".add_music:not(.disabled)",function(){l(d(this).closest("tr"))}).on("click",".delt_music",function(){q(d(this).closest("tr"))});w.on("click","button.d_add",function(){if(x==="mobile"){A();return}var E=o.find("input:checkbox:checked");if(E.length===0){alert("선택된 항목이 없습니다.");return}E.each(function(){if(l(d(this).closest("tr"))===false){return false}})});w.on("click","button.d_remove",function(){var E=i.find("input:checkbox:checked");if(E.length===0){alert("선택된 항목이 없습니다.");return}E.each(function(){q(d(this).closest("tr"))})});w.on("click","button.more",function(){if(x==="mobile"){return}k(true)});w.on("click","button.top",function(){if(x==="mobile"){return}C.find("div.song_list").animate({scrollTop:0},"fast")});s.on("keyup",function(E){if(E.keyCode===13){d("#d_btn_search").triggerHandler("click")}});d("#d_btn_search").on("click",function(){C.find("div.song_sort a:eq(0)").trigger("click")});w.on("click","li.list3 div.song_sort a",function(E){E.preventDefault();if(s.trimVal()===""){alert("검색어를 입력해주세요.");s.focus();return}d(this).activeRow("on");k()});w.on("click","tbody input:checkbox",function(F){var E=d(this);E.trigger("changed")}).on("changed","tbody input:checkbox",function(F){var E=d(this);E.closest("tr")[E.prop("checked")?"addClass":"removeClass"]("check")});i.on("addedlistchanged",function(H,G,I){var E=i.find("tr.d_added"),F=E.length;if(F>0){i.find("tr.d_no_data").hide()}else{i.find("tr.d_no_data").show()}u=[];E.find("input:checkbox").each(function(){u.push(this.value)});v.html(F);if(G==="removed"){p(w.find("tbody input:checkbox[value="+I+"]").closest("tr"),false)}});d("#d_btn_add").on("click",function(){var F=i.find("tr.d_added"),E=[];if(F.length===0){alert("선택된 친구가 없습니다.");return}F.each(function(){var H=d(this),I=H.find("input:checkbox").val(),G=H.find("span.user_nicnm").text();E.push({friendNo:I,nickName:G})});opener.MELON.WEBSVC.PubSub.trigger("addfriends.mypage",[E]);self.close()});k()},openPopup:function(h){b.util.openPopup(h,834,640)}}});b.define("WEBSVC.Mypage.AddSong",function(){return{init:function(){var s=d("div.chic_music_cont"),t=s.find("div.music_tab>ul").tabs({type:"parent-on"}),m=d("#d_kwd"),r=t.find(">li.on"),l=r.find("tbody"),i=d("#d_added_table tbody"),j="recent",q=false,h={recent:0,like:0,search:0};var k;function o(w){var x=w.find("input:checkbox").val();if(i.find("input:checkbox[value="+x+"]").length>0){return}if(i.find("tr.d_added").length>50){alert("최대 50곡까지 추가할 수 있습니다.");return false}var u=w.closest("tr").clone().removeClass("active").addClass("d_added"),v=u.children("td");v.eq(0).find("input:checkbox").prop("checked",false);v.eq(2).find("div.d_layer").hideLayer();v.eq(3).remove();v.eq(4).find("button").attr("title",function(){return(this.title||"").replace(/추가$/,"삭제")}).replaceClass("add_music","delt_music").children().text("삭제");i.append(u).trigger("addedlistchanged",["added",u])}function n(u){u.remove();i.trigger("addedlistchanged",["removed"])}function p(v){if(q){return}var u="",w={};switch(j){case"recent":u=t.find(">li:eq(0)>a").attr("href");break;case"like":u=t.find(">li:eq(1) div.song_sort a.on").attr("href");break;case"search":u=t.find(">li:eq(2) div.song_sort a.on").attr("href");break}q=true;if(j==="search"){w.kwd=m.trimVal()}else{if(j==="like"){w.type=r.find("select").val()}}if(!v){l.find("tr.d_item").remove();l.find("tr.d_no_data").hide();j==="search"&&l.find("tr.d_loading").show()}else{w.lastId=h[j];k=h[j]}d.ajax({url:u,data:w}).done(function(y){j==="search"&&l.find("tr.d_loading").hide();if(!v){l.find("tr:not(.d_no_data)").remove()}l.append(y);if(l.find("tr:last input.d_last_id").val()!=e){k=parseInt(l.find("tr:last input.d_last_id").val());h[j]=k}var x=l.find("tr:last input.isHasMore").val();if(k<1){d("button.btn_move").prop("disabled",true).addClass("disabled")}if(x!="true"){d("button.more").hide()}else{d("button.more").show()}}).fail(function(){}).always(function(){q=false;j==="search"&&l.find("tr.d_loading").hide()})}t.on("selected",function(v,u){switch(u){case 0:j="recent";break;case 1:j="like";break;case 2:j="search";break}r=t.find(">li.on");l=r.find("tbody");if(u<2){p()}});s.on("click","tbody input:checkbox",function(v){var u=d(this);u.trigger("changed")}).on("changed","tbody input:checkbox",function(v){var u=d(this);u.closest("tr")[u.prop("checked")?"addClass":"removeClass"]("active")});m.on("keyup",function(u){if(u.keyCode===13){d("#d_btn_search").triggerHandler("click")}});d("#d_btn_search").on("click",function(){r.find("div.song_sort a.on").click()});s.on("click","button.add_music, button.delt_music",function(){var u=d(this);if(u.hasClass("disabled")){return}if(u.hasClass("add_music")){o(u.closest("tr"))}else{n(u.closest("tr"))}});s.on("click","button.d_add",function(){var u=l.find("input:checkbox:checked");if(u.length===0){alert("선택된 항목이 없습니다.");return}u.each(function(){if(o(d(this).closest("tr"))===false){return false}})});s.on("click","button.d_remove",function(){var u=i.find("input:checkbox:checked");if(u.length===0){alert("선택된 항목이 없습니다.");return}u.each(function(){n(d(this).closest("tr"))})});s.on("click","button.top",function(){r.find("div.song_list").animate({scrollTop:0},"fast")});s.on("click","button.more",function(){p(true)});s.on("click","button.btn_move",function(){var v=d(this),u=i.find("tr:has(input:checked)");if(u.length===0){alert("곡을 선택해 주세요.");return}if(v.hasClass("up")){u.each(function(){var w=d(this);if(w.prev("tr:has(input:checked)").length>0){return}w.insertBefore(w.prev("tr:not(.d_no_data)"))})}else{if(v.hasClass("down")){Array.prototype.reverse.call(u).each(function(){var w=d(this);if(w.next("tr:has(input:checked)").length>0){return}w.insertAfter(w.next())})}else{if(v.hasClass("top")){i.find("tr.d_no_data").after(u)}else{if(v.hasClass("bottom")){i.append(u)}}}}});s.on("click","div.song_sort a",function(u){u.preventDefault();if(j==="search"&&m.trimVal()===""){alert("검색어를 입력해주세요.");m.focus();return}d(this).activeRow("on");p()});i.on("addedlistchanged",function(){var u=i.find("tr.d_added").length;d("#d_added_count").html(u);if(u>0){i.find("tr.d_no_rows").hide()}else{i.find("tr.d_no_rows").show()}});d("#d_ok").on("click",function(){var u=i.find("tr.d_added"),v=[];if(u.length===0){alert("선택된 곡이 없습니다.");return}u.each(function(){v.push(d(this).find("input[name=SONGID]").val())});opener.MELON.WEBSVC.PubSub.trigger("addsongs.mypage",[v]);self.close()});p()},openPopup:function(h){b.util.openPopup(h,834,640)}}});b.define("WEBSVC.Mypage.SendMessage",function(){var k="mymusicmessage_listFriend.htm";var i="";var h=getCookie("MPS");var j="MELONPLAYER";if(h!=null&&h.match("^"+j)==j){i="WP42"}return{init:function(){d("#d_message").textControl({counting:true,countType:"char",limit:160,limitTarget:"#d_text_count"})},initAddSong:function(w){var y=d("div.chic_music_cont"),A=y.find("div.music_tab>ul").tabs({type:"parent-on"}),r=d("#d_kwd"),x=A.find(">li.on"),q=x.find("tbody"),m=d("#d_added_table tbody"),o=d("div.serch_frend input"),n="recent",v=false,l={recent:0,like:0,search:0};var p;function t(E){var F=E.find("input:checkbox").val();if(m.find("input:checkbox[value="+F+"]").length>0){return}if(m.find("tr.d_added").length>=10){alert("10곡까지 추가 가능합니다.");return false}var C=E.closest("tr").clone().removeClass("active").addClass("d_added"),D=C.children("td");D.eq(0).find("input:checkbox").prop("checked",false);var B=C.find("td:eq(1)").find("a").html().replace(/<B>/g,"").replace(/<\/B>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");D.eq(1).find("a").html(B);D.eq(2).find("div.d_layer").hideLayer();D.eq(2).find("a").each(function(){var G=d(this).html().replace(/<B>/g,"").replace(/<\/B>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");d(this).html(G)});D.eq(3).remove();D.eq(4).find("button").attr("title",function(){return(this.title||"").replace(/추가$/,"삭제")}).replaceClass("add_music","delt_music").children().text("삭제");m.append(C).trigger("addedlistchanged",["added",C])}function s(B){B.remove();m.trigger("addedlistchanged",["removed"])}function u(C){if(v){return}y.find(".d_checkall").attr("checked",false);var B="",D={};switch(n){case"recent":B=A.find(">li:eq(0)>a").attr("href");break;case"like":B=A.find(">li:eq(1) div.song_sort a.on").attr("href");break;case"search":B=A.find(">li:eq(2) div.song_sort a.on").attr("href");D.sort=x.find("div.song_sort>*.on").attr("data-sort");D.kwd=encodeURIComponent(o.trimVal());break}v=true;if(n==="search"){D.kwd=r.trimVal()}else{if(n==="like"){D.filter=x.find("select").val()}}if(!C){q.find("tr.d_item").remove();n==="search"&&q.find("tr.d_loading").hide()}else{D.lastId=l[n];p=l[n]}if(n=="like"&&d("#likeSongArtist").find("option").length==1){d.ajax({url:"/mymusic/common/mymusiccommon_listSongArtist.json",data:D,dataType:"json"}).done(function(H){if(H.artistListCount>0){var I=H.artistList;var F="";var E="";for(var G=0;G<I.length;G++){F=JSON.stringify(I[G]);E=JSON.parse(F);d("#likeSongArtist").append('<option value="'+E.ARTISTID+'">'+E.ARTISTNAMEWEBLIST+"</option>")}}})}d.ajax({url:B,data:D,beforeSend:function(){x.find(".loading_wrap").show()}}).done(function(F){n==="search"&&q.find("tr.d_loading").hide();if(!C){q.find("tr:not(.d_no_data)").remove()}if(n==="search"){x.find(".loading_wrap").show()}q.append(F);if(n==="search"){x.find(".loading_wrap").hide()}if(q.find("tr").length>1){q.find("tr.d_no_data").hide()}else{q.find("tr.d_no_data").show();if(n=="search"){q.find("#songNone").text("검색 결과가 없습니다.")}}if(q.find("tr:last input.d_last_id").val()!=e){p=parseInt(q.find("tr:last input.d_last_id").val());l[n]=p}var E=q.find("tr:last input.isHasMore").val();if(p<1){d("button.btn_move").prop("disabled",true).addClass("disabled")}if(E!="true"){d("button.more").hide()}else{d("button.more").show()}}).fail(function(){}).always(function(){v=false;n==="search"&&q.find("tr.d_loading").hide()})}A.on("selected",function(C,B){y.find(".d_checkall").attr("checked",false);y.find(".a_checkall").attr("checked",false);switch(B){case 0:n="recent";break;case 1:n="like";break;case 2:n="search";break}x=A.find(">li.on");q=x.find("tbody");if(B<2){u()}else{r.trimVal("");q.html('<tr class="d_no_data"><td colspan="4" class="data_ynlk"><div class="wrap"><span id="songNone">검색어를 입력하세요. </span></div></td></tr>');d("button.more").hide()}});A.on("change","#likeSongArtist",function(B){u()});y.on("click","tbody input:checkbox",function(C){var B=d(this);B.trigger("changed")}).on("changed","tbody input:checkbox",function(C){var B=d(this);B.closest("tr")[B.prop("checked")?"addClass":"removeClass"]("active")});r.on("keypress",function(B){if(B.keyCode===13){d("#d_btn_search").triggerHandler("click")}});d("#d_btn_search").on("click",function(){x.find("div.song_sort a.on").click()});y.on("click","button.add_music, button.delt_music",function(){var B=d(this);if(B.hasClass("disabled")){return}if(B.hasClass("add_music")){if(m.find("input:checkbox[value="+d(this).closest("tr").find("input:checkbox").val()+"]").length>0){alert("이미 선택된 곡입니다.");return}t(B.closest("tr"))}else{if(!confirm("선택한 곡을 삭제하시겠습니까?")){return}s(B.closest("tr"))}});y.on("click","button.d_add",function(){var D=q.find("input:checkbox:checked");if(D.length===0){alert("곡을 선택해 주세요.");return}var C=0;var B=0;D.each(function(){C++;if(m.find("input:checkbox[value="+d(this).closest("tr").find("input:checkbox").val()+"]").length>0){B++}if(t(d(this).closest("tr"))===false){return false}});if(C==B){alert("이미 선택된 곡입니다.");return}});y.on("click","button.d_remove",function(){var B=m.find("input:checkbox:checked");if(B.length===0){alert("곡을 선택해 주세요.");return}if(!confirm("선택한 곡을 삭제하시겠습니까?")){return}B.each(function(){s(d(this).closest("tr"))})});y.on("click","button.top",function(){x.find("div.song_list").animate({scrollTop:0},"fast")});y.on("click","button.more",function(){u(true)});y.on("click","button.btn_move",function(){var C=d(this),B=m.find("tr:has(input:checked)");if(B.length===0){alert("곡을 선택해 주세요.");return}if(C.hasClass("up")){B.each(function(){var D=d(this);if(D.prev("tr:has(input:checked)").length>0){return}D.insertBefore(D.prev("tr:not(.d_no_data)"))})}else{if(C.hasClass("down")){Array.prototype.reverse.call(B).each(function(){var D=d(this);if(D.next("tr:has(input:checked)").length>0){return}D.insertAfter(D.next())})}else{if(C.hasClass("top")){m.find("tr.d_no_data").after(B)}else{if(C.hasClass("bottom")){m.append(B)}}}}});y.on("click","div.song_sort a",function(B){B.preventDefault();if(n==="search"&&r.trimVal()===""){alert("검색어를 입력해주세요.");r.focus();return}d(this).activeRow("on");u()});m.on("addedlistchanged",function(){var B=m.find("tr.d_added").length;d("#d_added_count").html(B);if(B>0){m.find("tr.d_no_rows").hide()}else{m.find("tr.d_no_rows").show()}});d("#d_ok").on("click",function(){d("#d_ok").attr("disabled",true);var G=d("div.chic_frend"),L=G.find(">ul"),E=d("div.d_friend_box"),M=E.find("ul.d_friend_list"),N=M.find("input[name=friendNo]"),H=[];var J=d("div.recm_music"),K=d("div.text_insert"),O=J.find("#d_hidden_emo").val(),D=K.find("#d_message").val();var I=m.find("tr.d_added"),F=[];N.each(function(){if(this.value!=0){H.push(this.value)}});if(H.length==0){alert("친구를 선택해 주세요.");d("#d_ok").attr("disabled",false);return}if(D.length==0){alert("메시지를 입력해 주세요.");d("#d_ok").attr("disabled",false);return}if(D=="메시지를 입력해 주세요."){alert("메시지를 입력해 주세요.");d("#d_ok").attr("disabled",false);return}I.each(function(){F.push(d(this).find("input[name=SONGID]").val())});if(H.length>10){alert("한 번에 최대 10명에게만 음악메시지 전송이 가능합니다.");d("#d_ok").attr("disabled",false);return}if(F.length>10){alert("10곡까지 추가 가능합니다.");d("#d_ok").attr("disabled",false);return}var C="N";var B=false;if(D.length>0){d.ajax({type:"POST",url:"/mymusic/common/mymusiccommon_checkRestrictWord.json",async:false,data:{inputStr:encodeURIComponent(D)},success:function(P){if(P.result==true){alert("작성하신 글 중 "+P.message+"은 금칙어 입니다. 수정 후 등록해주세요.");B=true;d("#d_ok").attr("disabled",false)}},error:function(Q,P,R){alert("서비스 응답이 없습니다");d("#d_ok").attr("disabled",false);C="Y"}});if(B){return}}if(C!="Y"){z(O,D,H,F)}});function z(D,E,B,C){d.ajax({url:"/mymusic/messagepresent/mymusicmessage_insert.json",data:{simplemsg:D,msg:encodeURIComponent(E),frienddata:B,songdata:C},success:function(G){if(G.msgChk==-501){alert("작성하신 글 중 "+G.message+"은 금칙어 입니다. 수정 후 등록해주세요.");return}if(G.msgChk==-502){alert("죄송합니다. 관리자에 의해 메시지 발송이 제한되었습니다.\n관련 문의사항은 1:1문의하기를 이용해주세요");return}if(G.RESULT>0){try{var H=MELON.WEBSVC.openPopup("/mymusic/messagepresent/popup/mymusicmessage_confirmPopup.htm",364,218,{target:"childPop",scrollbars:"no"},"center","메시지완료")}catch(F){}self.close()}else{if(G.RESULT==-4045){alert("차단된 회원입니다.\n최신버전의 멜론 모바일앱 음악메시지 설정 > 차단해제 후, 발송 가능합니다.");d("#d_ok").attr("disabled",false);return}else{if(G.RESULT==-4046){alert("죄송합니다.\n관리자에 의해 메시지 발송이 제한되었습니다.\n1:1 문의하기를 통해 제한 해제를 요청해주세요.");d("#d_ok").attr("disabled",false)}else{alert("음악메시지 전송을 실패하였습니다.")}}}},error:function(G,F,H){alert("서비스 응답이 없습니다.");d("#d_ok").attr("disabled",false)}})}u()},initMultiAddSong:function(m){d("#d_ok").on("click",function(){d("#d_ok").attr("disabled",true);var t=d("div.chic_frend"),x=t.find(">ul"),s=d("div.d_friend_box"),y=s.find("ul.d_friend_list"),z=y.find("input[name=friendNo]"),u=[];var v=d("div.recm_music"),w=d("div.text_insert"),A=v.find("#d_hidden_emo").val(),r=w.find("#d_message").val();var q=d("div.popup_cntt").find("#contsId").val();var n=d("div.popup_cntt").find("#contsType").val();z.each(function(){if(d(this).val()!=0){u.push(d(this).val())}});if(u.length==0){alert("친구를 선택해 주세요.");d("#d_ok").attr("disabled",false);return}if(r.length==0){alert("메시지를 입력해 주세요.");d("#d_ok").attr("disabled",false);return}if(r=="메시지를 입력해 주세요."){alert("메시지를 입력해 주세요.");d("#d_ok").attr("disabled",false);return}if(u.length>10){alert("한 번에 최대 10명에게만 음악메시지 전송이 가능합니다.");d("#d_ok").attr("disabled",false);return}var p=false;var o="N";if(r.length>0){d.ajax({type:"POST",url:"/mymusic/common/mymusiccommon_checkRestrictWord.json",async:false,data:{inputStr:encodeURIComponent(r)},success:function(B){if(B.result==true){alert("작성하신 글 중 "+B.message+"은 금칙어 입니다. 수정 후 등록해주세요.");d("#d_ok").attr("disabled",false);p=true}},error:function(C,B,D){alert("서비스 응답이 없습니다");d("#d_ok").attr("disabled",false);o="Y"}});if(p){return}}if(o!="Y"){l(A,r,u,q,n)}});function l(p,r,o,n,q){d.ajax({url:"/mymusic/messagepresent/mymusicmessage_insert.json",data:{simplemsg:p,msg:encodeURIComponent(r),frienddata:o,contsId:n,contsType:q},success:function(t){if(t.msgChk==-501){alert("작성하신 글 중 "+t.message+"은 금칙어 입니다. 수정 후 등록해주세요.");return}if(t.msgChk==-502){alert("죄송합니다. 관리자에 의해 메시지 발송이 제한되었습니다.\n관련 문의사항은 1:1문의하기를 이용해주세요");return}if(t.RESULT>0){try{var u=MELON.WEBSVC.openPopup("/mymusic/messagepresent/popup/mymusicmessage_confirmPopup.htm",364,218,{target:"childPop",scrollbars:"no"},"center","메시지완료")}catch(s){}self.close()}else{if(t.RESULT==-4045){alert("차단된 회원입니다.\n최신버전의 멜론 모바일앱 음악메시지 설정 > 차단해제 후, 발송 가능합니다.");d("#d_ok").attr("disabled",false);return}else{if(t.RESULT==-4046){alert("죄송합니다.\n관리자에 의해 메시지 발송이 제한되었습니다.\n1:1 문의하기를 통해 제한 해제를 요청해주세요.");d("#d_ok").attr("disabled",false)}else{alert("음악메시지 전송을 실패하였습니다.")}}}},error:function(t,s,u){alert("서비스 응답이 없습니다.");d("#d_ok").attr("disabled",false);return}})}},initFriend:function(p,z,v,E){var t=10,G=this,B=d("div.add_frend"),u=d("#d_tab"),A=d("#d_added_count"),l=d("#d_tab > li.on tbody"),H=u.find(">li.on"),r=H.find("tbody"),w=d("#d_kwd"),F=["friend","search"],C=F[0],D=false,y=[],n={friend:0,search:0};var m;d('input[name="frend_c"]').click(function(){o()});d("#friend_c").change(function(){o()});function q(I){return l.find("input:checkbox[value="+I+"]").length>0}function x(I){r.find("tr:not(.d_no_data)")[I?"noop":"remove"]();r.find("tr.d_no_data")[I?"hide":"show"]();H.find("button.more").prop("disabled",!I)[I?"removeClass":"addClass"]("disabled")}function o(K){if(D){return}var M={},J="";if(C==="search"){if(w.trimVal()===""){alert("검색어를 입력해주세요.");w.focus();return}J=H.find("div.song_sort a.on").attr("href");M.searchKeyword=w.trimVal()}else{J=H.find(">a").attr("href")}if(!K){r.find("tr:not(d_no_data)").hide()}else{M.lastId=n[C];m=n[C]}D=true;var L=d('input[name="frend_c"]:checked').val();var I=d("#friend_c option:selected").val();M.gubunCode=L;M.originCode=I;d.ajax({url:J,data:M,method:"post",beforeSend:function(){H.find(".loading_wrap").show()}}).done(function(P){if(!K){r.find("tr:not(.data_ynlk)").hide();r.find("tr").remove()}if(C==="search"){x(true)}r.append(P);H.find(".loading_wrap").hide();if(C==="search"){if(r.find("tr").length>0){r.find("tr.data_ynlk").hide()}else{r.append('<tr class="data_ynlk"><td colspan="2">검색 결과가 없습니다</td></tr>');r.find("tr.data_ynlk").show()}}else{if(r.find("tr").length>0){r.find("tr.data_ynlk").hide()}else{r.append('<tr class="data_ynlk"><td colspan="2">친구가 없습니다</td></tr>');r.find("tr.data_ynlk").show()}}if(r.find("tr:last input.d_last_id").val()!=e){m=parseInt(r.find("tr:last input.d_last_id").val());n[C]=m}var O=r.find("tr:last input.isHasMore").val();var N=r.find("tr:last input.totCount").val();if(m<1){d("button.btn_move").prop("disabled",true).addClass("disabled")}if(C=="search"){if(N==e){d("button.d_get_more").hide()}else{if(m>=N){d("button.d_get_more").hide()}else{d("button.d_get_more").show()}}}else{if(O!="true"){d("button.d_get_more").hide()}else{d("button.d_get_more").show()}}}).fail(function(){x(false);H.find(".loading_wrap").hide()}).always(function(){D=false})}function s(J,I){}u.tabs({type:"parent-on",condition:d("#d_tab"),selectors:{tabs:">li>a"},msgBefore:"선택하신 친구를 추가하지 않고 \r\n다른 탭으로 이동하실 경우 선택했던 내역이 사라집니다. \r\n이동하시겠습니까?",onSelected:function(J,I){C=F[I];H=u.find(">li.on");r=u.find(">li.on tbody");switch(I){case 0:o();break}u.find("tr").removeClass("check");u.find("input:checkbox").removeAttr("checked");w.val("");if(C!=="search"){var K=jQuery.inArray("search",F);u.find("li").eq(K).find("tbody").html('<tr class="data_ynlk d_no_data">\n<td colspan="2">검색창에 친구를 검색해 주세요.</td>\n</tr>')}if(C==="search"){if(MELON.WEBSVC.browser.isIE&&MELON.WEBSVC.browser.version<=9){u.find("#d_kwd").focus(function(){if(u.find("#d_kwd").val()==u.find("#d_kwd").attr("placeholder")){u.find("#d_kwd").val("")}}).blur(function(){if(u.find("#d_kwd").val()==""){u.find("#d_kwd").val(u.find("#d_kwd").attr("placeholder"))}}).blur()}d("button.d_get_more").hide()}}});B.on("click","button.more",function(){if(C==="mobile"){return}o(true)});B.on("click","button.top",function(){if(C==="mobile"){return}H.find("div.song_list").animate({scrollTop:0},"fast")});w.on("keypress",function(I){if(I.keyCode===13){d("#d_btn_search").triggerHandler("click")}});d("#d_btn_search").on("click",function(){H.find("div.song_sort a:eq(0)").trigger("click")});B.on("click","li.list2 div.song_sort a",function(I){I.preventDefault();if(w.trimVal()===""){alert("검색어를 입력해주세요.");w.focus();return}if(w.trimVal().length<2){alert("멜론 친구 닉네임은 두 글자 이상만 검색 가능합니다.");return}d(this).activeRow("on");o()});B.on("click","tbody input:checkbox",function(J){var I=d(this);I.trigger("changed")}).on("changed","tbody input:checkbox",function(J){var I=d(this);I.closest("tr")[I.prop("checked")?"addClass":"removeClass"]("check")});d(".popup").on("click","#d_btn_add",function(){var O=d("#d_tab > li.on tbody").find("tr.check"),K=[];if(O.length===0){alert("친구를 선택해주세요.");return}if(O.length===0&&d(".d_mobile_no").val().replace(/\s/g,"").length==0){alert("선택된 친구가 없습니다.");return}if(O.length>=t+1){alert("한 번에 최대 "+t+"명에게만 음악메시지 전송이 가능합니다.");return false}var L=0;var N=0;var M=0;var J=0;var I=0;O.each(function(){var S=d(this),T=S.find("input:checkbox").val(),R=S.find(".d_user_nicnm").text(),P=S.find(".memberStatus").val();for(var Q=0;Q<p;Q++){if(T==z[Q]){N++}if(T==E){M++}}if(R==""&&T==""){J++}else{if(P!="0"){I++}}});if(N==O.length){alert("이미 추가된 친구 입니다.");return}if(M>0){alert("회원 본인을 수신자로 선택할 수 없습니다.");return}L=(O.length-0)+(p-0)-(N-0);if(L>=t+1){alert("한 번에 최대 "+t+"명에게만 음악메시지 전송이 가능합니다.");return}if(J>0){alert("탈퇴한 회원 입니다.");return}if(I>0){alert("탈퇴한 회원 입니다.");return}O.each(function(){var R=d(this),S=R.find("input:checkbox").val(),Q=R.find(".d_user_nicnm").text(),P=R.find(".memberStatus").val();K.push({friendNo:S,nickName:Q,memberStatus:P})});opener.focus();opener.MELON.WEBSVC.PubSub.trigger("addfriends.mypage",[K])});o()},openPopup:function(l){b.util.openPopup(l,400,550)}}});b.define("WEBSVC.Mypage.SendPresent",function(){var l="popup/mymusicpresent_listFriend.htm?flag=Y";var j="popup/mymusicpresent_listFriend.htm";var i="";var h=getCookie("MPS");var k="MELONPLAYER";if(h!=null&&h.match("^"+k)==k){i="WP42"}return{init:function(){d("#d_message").textControl({counting:true,countType:"char",limit:160,limitTarget:"#d_text_count"})},initAddSong:function(D,q,t,p,v){var x=d("div.chic_music_cont"),u=x.find("div.music_tab>ul").tabs({type:"parent-on"}),w=d("#d_kwd"),E=u.find(">li.on"),r=E.find("tbody"),m=d("#d_added_table tbody"),y="recent",A=false,o={recent:0,like:0,search:0};var n;if(D>0){var s="Y";d.ajax({url:"/mymusic/common/mymusiccommon_songSimple.htm",data:{songIdsArr0:q.join(),presentChk:s}}).done(function(G){r.empty();r.append(G);var H=r.find("input:checkbox");H.each(function(){z(d(this).closest("tr"))});r.empty();var F=d(['<tr class="d_no_data"><td colspan="5" class="data_ynlk"><div class="wrap">최근 들은 곡이 없습니다.</div></td></tr>'].join(""));r.append(F);C()})}C();function z(I){var J=I.find("input:checkbox").val();if(m.find("input:checkbox[value="+J+"]").length>0){return}if(m.find("tr.d_added").length>=50){alert("한 번에 최대 50곡까지만 선물 가능합니다.");return false}var G=I.closest("tr").clone().removeClass("active").addClass("d_added"),H=G.children("td");H.eq(0).find("input:checkbox").prop("checked",false);var F=G.find("td:eq(1)").find("a").html().replace(/<B>/g,"").replace(/<\/B>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");H.eq(1).find("a").html(F);H.eq(2).find("div.d_layer").hideLayer();H.eq(2).find("a").each(function(){var K=d(this).html().replace(/<B>/g,"").replace(/<\/B>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");d(this).html(K)});H.eq(3).remove();H.eq(4).find("button").attr("title",function(){return(this.title||"").replace(/추가$/,"삭제")}).replaceClass("add_music","delt_music").children().text("삭제");m.append(G).trigger("addedlistchanged",["added",G])}function B(F){F.remove();m.trigger("addedlistchanged",["removed"])}function C(G){if(A){return}x.find(".d_checkall").attr("checked",false);var F="",H={};switch(y){case"recent":F=u.find(">li:eq(0)>a").attr("href");break;case"like":F=u.find(">li:eq(1) div.song_sort a.on").attr("href");break;case"search":F=u.find(">li:eq(2) div.song_sort a.on").attr("href");break}A=true;if(y==="search"){H.kwd=w.trimVal()}else{if(y==="like"){H.filter=E.find("select").val()}}if(!G){r.find("tr.d_item").remove();y==="search"&&r.find("tr.d_loading").hide()}else{H.lastId=o[y];n=o[y]}if(y=="like"&&d("#likeSongArtist").find("option").length==1){d.ajax({url:"/mymusic/common/mymusiccommon_listSongArtist.json",data:H,dataType:"json"}).done(function(L){if(L.artistListCount>0){var M=L.artistList;var J="";var I="";for(var K=0;K<M.length;K++){J=JSON.stringify(M[K]);I=JSON.parse(J);d("#likeSongArtist").append('<option value="'+I.ARTISTID+'">'+I.ARTISTNAMEWEBLIST+"</option>")}}})}d.ajax({url:F,data:H,beforeSend:function(){E.find(".loading_wrap").show()}}).done(function(J){r=E.find("tbody");y==="search"&&r.find("tr.d_loading").hide();if(!G){if(r.find("tr").length>1){r.find("tr:not(.d_no_data)").remove();r.find("tr.d_no_data").hide()}else{r.find("tr.d_no_data").show()}}r.append(J);if(y==="search"){E.find(".loading_wrap").hide()}if(r.find("tr").length>1){r.find("tr.d_no_data").hide()}else{r.find("tr.d_no_data").show();if(y==="search"){r.find("#songNone").text("검색 결과가 없습니다.")}}if(r.find("tr:last input.d_last_id").val()!=e){n=parseInt(r.find("tr:last input.d_last_id").val());o[y]=n}var I=r.find("tr:last input.isHasMore").val();if(n<1){d("button.btn_move").prop("disabled",true).addClass("disabled")}if(I!="true"){d("button.more").hide()}else{d("button.more").show()}E.find(".loading_wrap").hide()}).fail(function(){}).always(function(){A=false;y==="search"&&r.find("tr.d_loading").hide()})}u.on("selected",function(G,F){x.find(".d_checkall").attr("checked",false);x.find(".a_checkall").attr("checked",false);switch(F){case 0:y="recent";break;case 1:y="like";break;case 2:y="search";break}E=u.find(">li.on");r=E.find("tbody");if(F<2){C()}else{w.trimVal("");r.html('<tr class="d_no_data"><td colspan="4" class="data_ynlk"><div class="wrap"><span id="songNone">검색어를 입력하세요.</span></div>	</td></tr>');d("button.more").hide()}});u.on("change","#likeSongArtist",function(F){C()});x.on("click","tbody input:checkbox",function(G){var F=d(this);F.trigger("changed")}).on("changed","tbody input:checkbox",function(G){var F=d(this);F.closest("tr")[F.prop("checked")?"addClass":"removeClass"]("active")});w.on("keypress",function(F){if(F.keyCode===13){d("#d_btn_search").triggerHandler("click")}});d("#d_btn_search").on("click",function(){E=u.find(">li.on");E.find("div.song_sort a.on").click()});x.on("click","button.add_music, button.delt_music",function(){var F=d(this);if(F.hasClass("disabled")){return}if(F.hasClass("add_music")){if(m.find("input:checkbox[value="+d(this).closest("tr").find("input:checkbox").val()+"]").length>0){alert("이미 추가된 곡입니다.");return}z(F.closest("tr"))}else{if(!confirm("삭제하시겠습니까?")){return}B(F.closest("tr"))}});x.on("click","button.d_add",function(){var H=r.find("input:checkbox:checked");if(H.length===0){alert("곡을 선택해주세요.");return}var G=0;var F=0;H.each(function(){G++;if(m.find("input:checkbox[value="+d(this).closest("tr").find("input:checkbox").val()+"]").length>0){F++}if(z(d(this).closest("tr"))===false){return false}});if(G==F){alert("이미 추가된 곡입니다.");return}});x.on("click","button.d_remove",function(){var F=m.find("input:checkbox:checked");if(F.length===0){alert("곡을 선택해주세요.");return}if(!confirm("삭제하시겠습니까?")){return}F.each(function(){B(d(this).closest("tr"))})});x.on("click","button.top",function(){E.find("div.song_list").animate({scrollTop:0},"fast")});x.on("click","button.more",function(){C(true)});x.on("click","button.btn_move",function(){var G=d(this),F=m.find("tr:has(input:checked)");if(F.length===0){alert("곡을 선택해주세요.");return}if(G.hasClass("up")){F.each(function(){var H=d(this);if(H.prev("tr:has(input:checked)").length>0){return}H.insertBefore(H.prev("tr:not(.d_no_data)"))})}else{if(G.hasClass("down")){Array.prototype.reverse.call(F).each(function(){var H=d(this);if(H.next("tr:has(input:checked)").length>0){return}H.insertAfter(H.next())})}else{if(G.hasClass("top")){m.find("tr.d_no_data").after(F)}else{if(G.hasClass("bottom")){m.append(F)}}}}});x.on("click","div.song_sort a",function(F){F.preventDefault();if(y==="search"&&w.trimVal()===""){alert("검색어를 입력해주세요.");w.focus();return}d(this).activeRow("on");C()});m.on("addedlistchanged",function(){var F=m.find("tr.d_added").length;d("#d_added_count").html(F);if(F>0){m.find("tr.d_no_rows").hide()}else{m.find("tr.d_no_rows").show()}});d("#d_ok").on("click",function(){var K=d("div.recm_music");var J=m.find("tr.d_added"),I=[];if(J.length===0){alert("선택된 곡이 없습니다.");return}J.each(function(){I.push(d(this).find("input[name=SONGID]").val())});if(I.length>50){alert("한 번에 최대 50곡까지만 선물 가능합니다.");return}var F=0;for(var H=0;H<D;H++){for(var G=0;G<I.length;G++){if(q[H]==I[G]){F++}}}opener.focus();opener.MELON.WEBSVC.PubSub.trigger("addsongs.mypage",[I]);self.close()})},initFriend:function(q,A,C,w,H){var u=10;if(C=="Y"){u=5}var J=this,D=d("div.add_frend"),v=d("#d_tab"),B=d("#d_added_count"),m=d("#d_tab > li.on tbody"),K=v.find(">li.on"),s=K.find("tbody"),x=d("#d_kwd"),I=["recent","friend","search","mobile"],E=I[0],G=false,z=[],o={recent:0,friend:0,search:0};var n;function r(L){return $addedFriends.find("input:checkbox[value="+L+"]").length>0}function F(){return d("#d_tab li.on tbody")}function y(L){s.find("tr:not(.d_no_data)")[L?"noop":"remove"]();s.find("tr.d_no_data")[L?"hide":"show"]();K.find("button.more").prop("disabled",!L)[L?"removeClass":"addClass"]("disabled")}d('input[name="frend_c"]').click(function(){p()});d("#friend_c").change(function(){p()});function p(N){if(G){return}d(".tabChanged").val("");var P={},M="";if(E==="search"){if(x.trimVal()===""){alert("검색어를 입력해주세요.");x.focus();return}M=K.find("div.song_sort a.on").attr("href");P.searchKeyword=x.trimVal()}else{M=K.find(">a").attr("href")}if(!N){s.find("tr.d_item").remove();E==="search"&&s.find("tr.d_loading").hide()}else{P.lastId=o[E];n=o[E]}G=true;var O=d('input[name="frend_c"]:checked').val();var L=d("#friend_c option:selected").val();P.gubunCode=O;P.originCode=L;d.ajax({url:M,data:P,method:"post",beforeSend:function(){K.find(".loading_wrap").show()}}).done(function(S){s=K.find("tbody");if(!N){if(E==="search"){s.find("tr:not(.data_ynlk)").remove()}else{s.find("tr:not(.data_ynlk00)").remove()}}s.append(S);K.find(".loading_wrap").hide();if(E==="search"){if(s.find("tr").length>1){s.find("tr.data_ynlk").hide()}else{s.find("tr.data_ynlk").html('<td colspan="2"><div class="wrap">검색 결과가 없습니다.</div></td>');s.find("tr.data_ynlk").show()}}else{if(s.find("tr").length>1){s.find("tr.data_ynlk00").hide()}else{if(E==="recent"){s.find("tr.data_ynlk00").html('<td colspan="3" class="data_ynlk"><div class="wrap">최근 선물한 친구가 없습니다.</div></td>');s.find("tr.data_ynlk00").show()}else{s.find("tr.data_ynlk00").html('<td colspan="2" class="data_ynlk"><div class="wrap">친구가 없습니다.</div></td>');s.find("tr.data_ynlk00").show()}}}if(s.find("tr:last input.d_last_id").val()!=e){n=parseInt(s.find("tr:last input.d_last_id").val());o[E]=n}var R=s.find("tr:last input.isHasMore").val();var Q=s.find("tr:last input.totCount").val();if(n<1){d("button.btn_move").prop("disabled",true).addClass("disabled")}if(E=="search"){if(Q==e){d("button.d_get_more").hide()}else{if(n>=Q){d("button.d_get_more").hide()}else{d("button.d_get_more").show()}}}else{if(R!="true"){d("button.d_get_more").hide()}else{d("button.d_get_more").show()}}}).fail(function(){y(false);K.find(".loading_wrap").hide()}).always(function(){G=false})}function t(M,L){}v.tabs({type:"parent-on",condition:d("#d_tab"),selectors:{tabs:">li>a"},msgBefore:"선택하신 친구를 추가하지 않고<br />다른 탭으로 이동하실 경우 선택했던 내역이 사라집니다. <br />이동하시겠습니까?",onSelected:function(N,M,L){E=I[M];K=v.find(">li.on");s=v.find(">li.on tbody");switch(M){case 0:E="recent";p();break;case 1:E="friend";p();break;case 2:E="search";break;case 3:E="phone";break}v.find("tr").removeClass("check");v.find("input:checkbox").removeAttr("checked");v.find(".d_mobile_no").val("");x.val("");if(E!=="search"){var O=jQuery.inArray("search",I);v.find("li").eq(O).find("tbody").html('<tr class="data_ynlk d_no_data">\n<td colspan="2">검색창에 친구를 검색해 주세요.</td>\n</tr>')}if(E==="search"){if(MELON.WEBSVC.browser.isIE&&MELON.WEBSVC.browser.version<=9){v.find("#d_kwd").focus(function(){if(v.find("#d_kwd").val()==v.find("#d_kwd").attr("placeholder")){v.find("#d_kwd").val("")}}).blur(function(){if(v.find("#d_kwd").val()==""){v.find("#d_kwd").val(v.find("#d_kwd").attr("placeholder"))}}).blur()}d("button.d_get_more").hide()}if(E==="phone"){if(MELON.WEBSVC.browser.isIE&&MELON.WEBSVC.browser.version<=9){s.find("#d_mobile").focus(function(){if(s.find("#d_mobile").val()==s.find("#d_mobile").attr("placeholder")){s.find("#d_mobile").val("")}}).blur(function(){if(s.find("#d_mobile").val()==""){s.find("#d_mobile").val(s.find("#d_mobile").attr("placeholder"))}}).blur()}}}});D.on("click","button.top",function(){K.find("div.song_list").animate({scrollTop:0},"fast")});d("button.d_get_more").on("click",function(){p(true)});x.on("keypress",function(L){if(L.keyCode===13){d("button.d_btn_search").triggerHandler("click")}});d("button.d_btn_search").on("click",function(){d("#d_tab li.list3").find("div.song_sort a:eq(0)").triggerHandler("click")});d("#d_tab li.list3").find("div.song_sort a").on("click",function(L){L.preventDefault();if(E==="search"&&x.trimVal()===""){alert("검색어를 입력해주세요.");x.focus();s.html('<tr class="data_ynlk d_no_data">\n<td colspan="2">검색창에 친구를 검색해 주세요.</td>\n</tr>');return}if(x.trimVal().length<2){alert("멜론 친구 닉네임은 두 글자 이상만 검색 가능합니다.");return}d(this).activeRow("on");p()});d(".popup").on("click","#d_btn_add",function(){var S=d("#d_tab > li.on tbody").find("tr.check"),L=[];if(S.length===0&&d(".d_mobile_no").val().replace(/\s/g,"").length==0){alert("친구를 선택해주세요.");return}if(S.length>=u+1){alert("한 번에 최대 "+u+"명에게만 선물 가능합니다.");return}if(S.length!=0){var T=0;var U=0;var W=0;var M=0;var P=0;var R=0;S.each(function(){var ab=d(this),ac=ab.find("input:checkbox").val(),aa=ab.find(".d_user_nicnm").text(),Y=ab.find(".memberStatus").val();for(var Z=0;Z<q;Z++){if(ac==A[Z]){U++}if(ac==H){W++}}if(aa==""&&ac==""){M++}else{if(!/^(?:010|011|016|017|018|019)[\d]{7,8}$/.test(ac)&&Y!="0"){P++}}});if(U==S.length){alert("이미 추가된 친구 입니다.");return}if(W>0){alert("회원 본인을 수신자로 선택할 수 없습니다.");return}T=(S.length-0)+(q-0)-(U-0);if(T>=u+1){alert("한 번에 최대 "+u+"명에게만 선물 가능합니다.");return}if(M>0){alert("탈퇴한 회원 입니다.");return}if(P>0){alert("탈퇴한 회원 입니다.");return}S.each(function(){var aa=d(this),ab=aa.find("input:checkbox").val(),Z=aa.find(".d_user_nicnm").text(),Y=aa.find(".memberStatus").val();L.push({friendNo:ab,nickName:Z,memberStatus:Y})})}else{if(d(".d_mobile_no").val().replace(/\s/g,"").length==0||d(".d_mobile_no").val()=="“-”자 없이 입력"){alert("친구를 선택해주세요.");return}else{var Q=escape(d(".d_mobile_no").val());var V=0;var N=0;if(Q.match(/^\d+$/ig)==null){V=-1}if(Q.length<10&&V==0){alert("휴대폰 번호는 10자리 이상 입력하셔야 합니다.");d(".d_mobile_no").focus();return}if(!/^(?:010|011|016|017|018|019)[\d]{7,8}$/.test(d(".d_mobile_no").val())){alert("휴대폰 번호가 잘못 되었습니다.");d(".d_mobile_no").focus();return}for(var O=0;O<q;O++){if(d(".d_mobile_no").val()==A[O]){N++}}if(N>0){alert("이미 추가된 번호입니다.");return}var X=0;if(d(".d_mobile_no").val().length==11){X=d(".d_mobile_no").val().substring(0,3)+"-"+d(".d_mobile_no").val().substring(3,7)+"-"+d(".d_mobile_no").val().substring(7,11)}else{if(d(".d_mobile_no").val().length==12){X=d(".d_mobile_no").val().substring(0,3)+"-"+d(".d_mobile_no").val().substring(3,8)+"-"+d(".d_mobile_no").val().substring(8,12)}else{if(d(".d_mobile_no").val().length==13){X=d(".d_mobile_no").val().substring(0,3)+"-"+d(".d_mobile_no").val().substring(3,9)+"-"+d(".d_mobile_no").val().substring(9,13)}else{X=d(".d_mobile_no").val().substring(0,3)+"-"+d(".d_mobile_no").val().substring(3,6)+"-"+d(".d_mobile_no").val().substring(6,10)}}}L.push({friendNo:d(".d_mobile_no").val(),nickName:X,memberStatus:"0"})}}opener.focus();opener.MELON.WEBSVC.PubSub.trigger("addfriends.mypage",[L])});D.on("click","tbody input:checkbox",function(M){var L=d(this);L.trigger("changed")}).on("changed","tbody input:checkbox",function(M){var L=d(this);L.closest("tr")[L.prop("checked")?"addClass":"removeClass"]("check")});p()},openPopup:function(m){b.util.openPopup(m,834,640)}}});b.define("WEBSVC.FriendList",function(){var h=false;return{init:function(i){if(h){return}h=true;var j=this;f.on("click.userlist",".d_user_list button.hidden_frend","button.btn_small02.hidden_frend",function(p){p.preventDefault();p.stopPropagation();var t=d(this),r=t.hasClass("on"),o=!r,n=t.attr("data-user-no"),q=t.attr("data-menu-id"),s=t.attr("data-user-name")||"",m=(function(){var u=t.attr("data-target-id");if(!u){return t}u=u.substr(0,1)==="#"?u:"#"+u;return d(u)})(),k,l;t.trigger((l=d.Event("joinbefore")),[n,o]);if(l.isDefaultPrevented()){return}if(!MELON.WEBSVC.POC.login.isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd("");return}if(r){if(!confirm("숨김친구를 해제하시겠습니까?")){return}k=j.leave(n,q)}else{if(n==getMemberKey()){alert("나와는 친구를 맺을 수 없습니다.");return}if(!confirm("친구를 목록에서 숨김 하시겠습니까?\n숨긴처리를 해제하려면 숨김친구 목록에서\n해제 버튼을 눌러주세요!")){return}k=j.join(n,q)}k.done(function(u){if(u.result===true){t.trigger("friendchanged")}else{alert(u.errorMessage)}}).fail(function(u){alert(u||"예상치 못한 이유로 작업이 중단되었습니다.")})})},_ajax:function(i,j){if(!MELON.WEBSVC.POC.login.isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd("");return}d.ajax({url:i,type:"POST",dataType:"json"}).done(function(k){j.resolve.apply(null,arguments)}).fail(function(){j.reject(["알수 없는 이유로 작업을 중단하였습니다."])})},join:function(i,k){var j=d.Deferred();if(!i){j.reject(['유저 번호가 없습니다.(숨김 버튼에 data-user-no=""를 넣어주세요.)']);return j}this._ajax("/mymusic/friend/mymusicfriendaddsme_insertHiddenFriend.json?fMemberKey="+i+"&menuId="+k,j);return j},leave:function(i,k){var j=d.Deferred();if(!i){j.reject(['유저 번호가 없습니다.(숨김 버튼에 data-user-no=""를 넣어주세요.)']);return j}this._ajax("/mymusic/friend/mymusicfriendaddsme_deleteHiddenFriend.json?fMemberKey="+i+"&menuId="+k,j);return j}}})})(jQuery,MELON.WEBSVC,MELON.PBPGN);
/*!
 * @author 김승일
 * @email comahead@vi-nyl.com
 * @description DJ 플레이리스트(melonweb_dj.js를 인클루드해서 하고 싶은데..세개이상 인클루드하지 말라는 요청으로 인애..그대로 복사해서 가져옴)
 */
(function(c,a,b,d){var e=c(document);a.define("WEBSVC.DJCollection",function(){var f=false;return{template:{button:{normal:'<span class="odd_span">{TXT}</span>\n<span class="cnt"><span class="none">총건수</span>{CNT}</span>'},a:{normal:'<span class="icon">{TXT}</span>\n<strong class="none">총건수</strong>{CNT}'}},init:function(){if(f){return}f=true;var g=this;e.on("click.djcollection","div.d_djcol_list button.d_checkall",function(h){c(this).closest("div.d_djcol_list").find("thead input:checkbox").trigger("click")});e.on("click.djcollection",".d_djcol_list button.like, .d_djcol_list a.btn_like",function(m){m.preventDefault();var q=c(this),l=q.attr("data-djcol-no"),o=q.attr("data-djcol-menuId"),p=q.attr("title").split(" 좋아요"),n=q.hasClass("on"),k=!n,j=a.number.addComma,h,i;if(!l){alert("좋아요 버튼에 data-djcol-no 속성을 넣어 주세요");return}q.trigger((i=c.Event("likebefore")),[l,k]);if(i.isDefaultPrevented()){return}q.trigger("mouseleave");if(n){if(q.hasClass("mymusic_like2")){a.confirm2("좋아요를 취소 하시겠습니까?").on("ok",function(){r(g.dislike(l,o))}).on("cancel",function(){return false})}else{r(g.dislike(l,o))}}else{r(g.like(l,o))}function r(s){var s=s;s.done(function(u){var t="";var v=0;if(u.result===true){if(u.data.SUMMCNT>999999){v="999,999+"}else{v=u.data.SUMMCNT.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,")}n&&a.alert2("좋아요 취소되었습니다.",{opener:q,removeOnClose:true,overlayNotClose:true});q.trigger((i=c.Event("likechanged")),[l,p[0],k,v]);if(i.isDefaultPrevented()){return}q[k?"addClass":"removeClass"]("on").attr("title",p[0]+(k?" 좋아요 취소":" 좋아요"));if(q.is("button")){t=g.template.button[q.attr("data-tmpl-name")||"normal"]}else{t=g.template.a[q.attr("data-tmpl-name")||"normal"]}q.html(t.replace(/\{TXT\}/g,(k?"좋아요 취소":"좋아요")).replace(/\{CNT\}/g,v));if(q.attr("data-target-id")!=d){c("#"+q.attr("data-target-id")).html(u.data.SUMMCNT.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"))}k&&a.alert2("좋아요 반영되었습니다.",{opener:q,removeOnClose:true,overlayNotClose:true})}else{alert(u.errorMessage)}}).fail(function(t){alert(t)})}})},_ajax:function(g,h){if(!MELON.WEBSVC.POC.login.isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd("");return}c.ajax({url:g,type:"POST",async:false}).done(function(i){h.resolve.apply(null,arguments)}).fail(function(){h.reject(["알수 없는 이유로 작업을 중단하였습니다."])})},like:function(g,i){var h=c.Deferred();if(!g){h.reject(['DJ플레이리스트 번호가 없습니다.(좋아요 버튼에 data-djcol-no=""를 넣어주세요.)']);return h}if(!i){h.reject(['메뉴 아이디가 없습니다.(좋아요 버튼에 data-djcol-menuId=""를 넣어주세요.)']);return h}this._ajax("/mymusic/common/mymusiccommon_insertLike.json?contsId="+g+"&type=djplaylist&menuId="+i,h);return h},dislike:function(g,i){var h=c.Deferred();if(!g){h.reject(['DJ플레이리스트 번호가 없습니다.(좋아요 버튼에 data-djcol-no=""를 넣어주세요.)']);return h}if(!i){h.reject(['메뉴 아이디가 없습니다.(좋아요 버튼에 data-djcol-menuId=""를 넣어주세요.)']);return h}this._ajax("/mymusic/common/mymusiccommon_deleteLike.json?contsId="+g+"&type=djplaylist&menuId="+i,h);return h}}});a.define("WEBSVC.MyMusic.DJCollection.InfoWriter",{init:function(){var g=this,f="";c.ajax({url:"/mymusic/dj/popup/mymusicdjplaylistinsert_cateTypeCodeList.htm?type=theme"}).done(function(h){c("#d_thema").after(h);c.ajax({url:"/mymusic/dj/popup/mymusicdjplaylistinsert_cateTypeCodeList.htm?type=gnr"}).done(function(k){c("#d_ganre").after(k);var j=c("dd.gubun");j.on("click",">div>input[type=radio]",function(r){var q=c(this);if(q.siblings("input[type=hidden]").length===0){q.siblings("button").trigger("click")}else{i(q.parent(),q.parent().index()===0?"테마":"장르")}});function p(v,r,u,s){var x=c(this),t=x.closest("div.layer_popup"),q=t.find("div.box_"+u+"_chic ul"),w=x.find("> span:eq(1)").text(),y=x.attr("data-"+v+"-no");if(q.find("li").length===s){if(v==="theme"){alert("테마는 2개까지 선택하실 수 있습니다.");return}else{alert("장르는 1개까지 선택하실 수 있습니다.");return}}if(q.find("li[data-"+v+"-no="+y+"]").length>0){alert("이미 추가된 "+r+"입니다.");return}if(v==="theme"){q.append(['<li data-theme-no="'+y+'">',"<span>"+w+"</span>",'<button type="button" title="'+w+' 테마 삭제" class="btn_delt"></button></li>'].join(""))}else{q.append(['<li data-genre-no="'+y+'" class="'+(x.parent()[0].className||"")+'">','<span class="icon '+u+""+(x.parent().index()+1)+'">'+w+"</span>",'<button type="button" title="'+w+' 장르 삭제" class="btn_delt"></button></li>'].join(""))}t.trigger("addedcatelistchanged",["added"])}function i(r,s){var q=[];r.find(">input[type=hidden]").each(function(){q.push(c(this).attr("data-name"))});r.find(">input:radio").prop("checked",true);r.siblings("span.icon_noti").hide();r.siblings("span.fc_strong").html(s+": <strong>"+q.join(", ")+"</strong>").show()}function m(t,s,r,u){var q="";if(u.length===0){alert("선택된 "+r+"가 없습니다.");return false}u.each(function(){var v=c(this);q+='<input type="hidden" name="cateCode" value="'+v.attr("data-"+s+"-no")+'" data-name="'+v.find(">span").text()+'" />'});t.find(">input:radio").prop("checked",true);j.find("input[type=hidden]").remove();t.find(">[type=hidden]").remove().end().prepend(q)}function n(q,v,s,r,t,u){q.find("div.layer_popup").on("modalshow",function(){c(this).find("div.box_"+t+"_chic").find(">ul").empty().hide().end().find(">p").hide()}).on("click","div.collection_chic_list button",function(w){p.call(this,s,r,t,u)}).on("click","div.box_"+t+"_chic ul button",function(){if(!confirm("선택한 "+r+"를 삭제하시겠습니까?")){return}var w=c(this),x=w.closest("div.layer_popup");w.parent().remove();x.trigger("addedcatelistchanged",["removed"])}).on("modalok",function(w){if(m(q,s,r,c(this).find("div.box_"+t+"_chic li"))===false){w.preventDefault();return}i(q,r)}).on("modalcancel",function(){if(q.find(">input[type=hidden]").length===0){q.find(">input[type=radio]").prop("checked",false);if(v.find(">input[type=hidden]").length===0){j.find(">span.icon_noti").show();j.find(">span.fc_strong").html("").hide()}else{v.find("input[type=radio]").trigger("click")}}}).on("addedcatelistchanged",function(){var x=c(this).find("div.box_"+t+"_chic ul"),w=x.find(">li").length;if(w===0){x.hide().siblings("p").hide()}else{x.show().siblings("p").show()}})}var l=j.find(">div:first");var o=j.find(">div:eq(1)");n(l,o,"theme","테마","themalk",2);n(o,l,"genre","장르","gnr",1)})})}});a.define("WEBSVC.MyMusic.DJCollection.SongSelector",{update:false,fame:false,init:function(n){var j=this,l=c("div.music_tab>ul").tabs({type:"parent-on"});tabModes=["playlist","recent","like","search"],tabMode="playlist",$activeTab=l.find("li.on"),$activeTable=$activeTab.find("tbody"),$rightTable=c("div.chic_fin tbody"),$kwd=c("div.serch_frend input"),$btnSearch=c("div.serch_frend button"),$btnTitle=c("div.chic_fin button.d_btn_settitle"),isLoading=false,xhr=null,menuId=c("div.chic_music_cont").attr("data-menuId");var f="";c.extend(j,n);l.on("selected",function(p,o){tabMode=tabModes[o];$activeTab=l.find(">li:eq("+o+")");$activeTable=$activeTab.find("tbody");if(o!==3){k()}else{$kwd.trimVal("");$activeTable.html('<tr class="d_no_data"><td colspan="4" class="data_ynlk"><div class="wrap">현재 검색된 곡이 없습니다.</div></td></tr>');$activeTable.parent().find("thead input:checkbox").prop("checked",false);c("button.more").hide()}});c("div.song_list").addClass("d_scrolldiv");c("thead input:checkbox").addClass("d_checkall").on("click",function(){c(this).closest("table").find("tbody input:checkbox").trigger("checkboxchanged",[c(this).prop("checked")])});c("div.chic_music_cont").on("click","tbody input:checkbox:enabled",function(o){o.stopPropagation();c(this).trigger("checkboxchanged",this.checked)}).on("checkboxchanged","div.song_list tbody input:checkbox:enabled",function(q,o){q.stopPropagation();var p=c(this);p.closest("tr")[o?"addClass":"removeClass"]("active")});$kwd.on("keypress",function(o){if(o.keyCode===13){$btnSearch.triggerHandler("click")}});$btnSearch.on("click",function(){k()});l.find("li:first").on("click","tbody a",function(o){o.preventDefault();window.open("/mymusic/dj/popup/mymusicdjplaylistinsert_playlistSongListPopup.htm?plylstSeq="+c(this).closest("tr").find("input:checkbox").val(),"playlistpopup","app_,width=560,height=680,scrollbars=yes")});c("div.chic_music_cont").on("click","button.add_music:not(.disabled), button.delt_music:not(.disabled)",function(){var o=c(this);if(o.hasClass("add_music")){f="";if(tabMode==="playlist"){i(c(this).closest("tr").find("input:checkbox").val())}else{if($rightTable.find("input:checkbox[value="+c(this).closest("tr").find("input:checkbox").val()+"]").length>0){alert("중복된 곡은 한번만 선곡됩니다.");return}if($rightTable.find("tr.d_added").length+1>1000){alert("플레이리스트에는 최대 1,000곡까지 담기 가능합니다.\n편집모드에서 수록곡을 수정하신 후 다시 시도해주세요.");return}else{g(o.closest("tr"));$rightTable.trigger("addedlistchanged",["added"])}}}else{if(!confirm("해당 DJ플레이리스트의 선택된 곡을 삭제 하시겠습니까?")){return}h(o.closest("tr"))}});c("div.chic_music_cont").on("click","button.d_move_right",function(){f="";if($rightTable.find(">tr.d_added").length>=1000){alert("플레이리스트에는 최대 1,000곡까지 담기 가능합니다.\n편집모드에서 수록곡을 수정하신 후 다시 시도해주세요.");return}var q=$activeTable.find("input:checkbox:checked");if(tabMode==="playlist"){if(q.length===0){alert("선택된 플레이리스트가 없습니다. 플레이리스트를 선택해주세요.");return}q.each(function(){i(c(this).val());c(this).prop("checked",false).closest("tr").removeClass("active")})}else{if(q.length===0){alert("곡을 선택해 주세요.");return}var p=0;var o=0;if($rightTable.find("tr.d_added").length===0){q.each(function(){if(g(c(this).closest("tr"))===false){return false}});$rightTable.trigger("addedlistchanged",["added"])}else{q.each(function(){p++;if($rightTable.find("input:checkbox[value="+c(this).closest("tr").find("input:checkbox").val()+"]").length>0){o++}});if(p==o){alert("중복된 곡은 한번만 선곡됩니다.");return}else{if(o>0){if($rightTable.find("tr.d_added").length+(p-o)>1000){alert("플레이리스트에는 최대 1,000곡까지 담기 가능합니다.\n편집모드에서 수록곡을 수정하신 후 다시 시도해주세요.");return}else{q.each(function(){if(g(c(this).closest("tr"))===false){return false}});$rightTable.trigger("addedlistchanged",["added"]);alert("이미 선택된 곡을 제외하고 추가되었습니다.")}}else{if($rightTable.find("tr.d_added").length+p>1000){alert("플레이리스트에는 최대 1,000곡까지 담기 가능합니다.\n편집모드에서 수록곡을 수정하신 후 다시 시도해주세요.");return}else{q.each(function(){if(g(c(this).closest("tr"))===false){return false}});$rightTable.trigger("addedlistchanged",["added"])}}}}}$activeTable.parent().find("thead input:checkbox").prop("checked",false)});c("div.chic_music_cont").on("click","button.d_remove_right",function(){var o=$rightTable.find("tr:has(input:checked)");if(j.fame){alert("명예의 전당에 등록된 DJ플레이리스트는 곡 추가만 가능합니다.");return}if(o.length===0){alert("곡을 선택해 주세요.");return}if(!confirm("해당 DJ플레이리스트의 선택된 곡을 삭제 하시겠습니까?")){return}o.remove();$rightTable.parent().find("thead input:checkbox").prop("checked",false);$rightTable.trigger("addedlistchanged",["removed"])});c("div.view_more button.top").on("click",function(){$activeTab.find("div.song_list").animate({scrollTop:0},"fast")});c("div.view_more button.more").on("click",function(){k(true)});l.on("click",">li:gt(0) div.song_sort>a",function(r){r.preventDefault();if(tabMode==="search"&&$kwd.trimVal()===""){alert("검색어를 입력해 주세요.");$kwd.focus();return}var q=c(this),o=q.addClass("on").attr("class");q.siblings(".on").replaceWith(function(){var t=c(this),s=t.removeClass("on").attr("class");return'<a href="javascript:;" data-sort="'+t.attr("data-sort")+'" title="'+t.attr("data-title")+'" class="'+s+'">'+t.text()+"</a>"});var p=c('<strong tabindex="0" data-sort="'+q.attr("data-sort")+'" data-title="'+q.attr("title")+'" class="'+o+'">'+q.text()+"</strong>");q.replaceWith(p);p.focus();k()});l.on("change","#likeSongArtist",function(o){k()});$rightTable.on("addedlistchanged",function(q,o){var p=$rightTable.find("tr.d_added").length;c("div.chic_fin>div.music_tab em").html(p);if(p>0){$rightTable.find("tr.d_no_data").hide()}else{$rightTable.find("tr.d_no_data").show();p===0&&$rightTable.parent().find("thead input:checkbox").prop("checked",false)}if(o==="removed"){m()}}).triggerHandler("addedlistchanged");$rightTable.parent().on("click","input:checkbox",function(){m()});$btnTitle.on("click",function(p){var q=$rightTable.find("tr:has(input:checked)");if(($btnTitle.attr("title")||"").indexOf("선정")!==-1){if(q.length===0){alert("선정할 타이틀곡을 선택해 주세요.");return}else{if(q.length>1){alert("타이틀곡은 1곡만 지정가능합니다.");return}}var o=$rightTable.find("tr.d_title");o.find("input[name=title_song_no]").remove().end().removeClass("d_title").find("div.td_wrap").find("span.title").remove().end().find("a").removeClass("title");q.each(function(){c(this).addClass("d_title").find("div.td_wrap").find("a").addClass("title").find("span.icon_play.medium").after(' <span class="icon_song title">Title</span>');var r=c(this).find("input:checkbox");r.after('<input type="hidden" name="title_song_no" value="'+r.val()+'" />')})}else{q.filter(".d_title").find("input[name=title_song_no]").remove().end().removeClass("d_title").find("div.td_wrap").find("span.title").remove().end().find("a").removeClass("title")}m()});c("div.chic_fin div.add_bg").on("click","button.btn_move",function(){var p=c(this),o=$rightTable.find("tr:has(input:checked)");if(o.length===0){alert("곡을 선택해 주세요.");return}if(p.hasClass("up")){o.each(function(){var q=c(this);if(q.prev("tr:has(input:checked)").length>0){return}q.insertBefore(q.prev("tr:not(.d_no_data)"))})}else{if(p.hasClass("down")){Array.prototype.reverse.call(o).each(function(){var q=c(this);if(q.next("tr:has(input:checked)").length>0){return}q.insertAfter(q.next())})}else{if(p.hasClass("top")){$rightTable.find("tr.d_no_data").after(o)}else{if(p.hasClass("bottom")){$rightTable.append(o)}}}}$rightTable.trigger("addedlistchanged",["order"])});a.PubSub.on("playlistaddsongs",function(p,o){i(o,true)});function m(){var o=$rightTable.find(">tr:has(input:checked)"),q="해제",p="선정";if(o.length===1&&o.hasClass("d_title")){q="선정",p="해제"}else{if(o.filter(".d_title").length>0){q="선정",p="해제"}}$btnTitle.attr("title",($btnTitle.attr("title")||"").replace(q,p)).find(">span>span").html("타이틀 "+p)}function i(q,p){if($rightTable.find(">tr.d_added").length>=1000){alert("플레이리스트에는 최대 1,000곡까지 담기 가능합니다.\n편집모드에서 수록곡을 수정하신 후 다시 시도해주세요.");return}var r=$rightTable.find("input:checkbox");var o=new Array();r.each(function(){o.push(c(this).closest("tr").find("input:checkbox").val())});if(xhr&&xhr.readyState!==4){alert("조회중입니다. 잠시만 기다려 주세요.");return}xhr=c.ajax({type:"POST",url:"/mymusic/dj/mymusicdjplaylistinsert_playlistSongList.htm",data:{plylstSeq:q,type:"playlist"},async:false}).done(function(t){var v=c("<table><tbody></tbody></table>").find(">tbody").append(t).find(">tr");var u=0;var s=0;if($rightTable.find("tr.d_added").length===0){v.each(function(){if(g(c(this))===false){return false}}).closest("table").remove();$rightTable.trigger("addedlistchanged",["added"])}else{v.each(function(){u++;if($rightTable.find("input:checkbox[value="+c(this).find("input:checkbox").val()+"]").length>0){s++}});if(u==s){alert("중복된 곡은 한번만 선곡됩니다.");return}else{if(s>0){if($rightTable.find("tr.d_added").length+(u-s)>1000){alert("플레이리스트에는 최대 1,000곡까지 담기 가능합니다.\n편집모드에서 수록곡을 수정하신 후 다시 시도해주세요.");return}else{v.each(function(){if(g(c(this))===false){return false}}).closest("table").remove();$rightTable.trigger("addedlistchanged",["added"]);alert("이미 선택된 곡을 제외하고 추가되었습니다.")}}else{if($rightTable.find("tr.d_added").length+u>1000){alert("플레이리스트에는 최대 1,000곡까지 담기 가능합니다.\n편집모드에서 수록곡을 수정하신 후 다시 시도해주세요.");return}else{v.each(function(){if(g(c(this))===false){return false}}).closest("table").remove();$rightTable.trigger("addedlistchanged",["added"])}}}}})}function g(t){var s=$rightTable.find("tr.d_added").length;if(s===0){$rightTable.find("tr.d_no_data").hide()}var r=t.removeClass("active").find("input:checkbox").prop("checked",false),u=r.val();if($rightTable.find("input:checkbox[value="+u+"]").length>0){return}if($rightTable.find("tr.d_added").length>=1000){alert("플레이리스트에는 최대 1,000곡까지 담기 가능합니다.\n편집모드에서 수록곡을 수정하신 후 다시 시도해주세요.");return false}var p=t.closest("tr").clone().removeClass("active").addClass("d_added");if(tabMode==="search"){p.find("td:eq(0)").find("input:checkbox").prop("checked",false);var o=p.find("td:eq(1)").find("a").html().replace(/<B>/g,"").replace(/<\/B>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");p.find("td:eq(1)").find("a").html(o);p.find("td:eq(2)").find("div.d_layer").hideLayer().find("span[class^=bullet]").attr("class","bullet_vertical");p.find("td:eq(2)").find("a").each(function(){var v=c(this).html().replace(/<B>/g,"").replace(/<\/B>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");c(this).html(v)});var q=p.find("td:eq(3)").find("a").html().replace(/<B>/g,"").replace(/<\/B>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");p.find("td:eq(3)").find("a").html(q)}else{p.find("td:eq(0)").find("input:checkbox").prop("checked",false);p.find("td:eq(2)").find("div.d_layer").hideLayer().find("span[class^=bullet]").attr("class","bullet_vertical")}if(j.update){if(f==""){$rightTable.find("tr.d_no_data").after(p)}else{$rightTable.find(f).after(p)}f=p}else{$rightTable.append(p)}}function h(o){o.remove();$rightTable.trigger("addedlistchanged",["removed"])}function k(p){if(xhr&&xhr.readyState!==4){alert("조회중입니다. 잠시만 기다려 주세요.");return}var o="",q={};switch(tabMode){case"playlist":o="/mymusic/dj/mymusicdjplaylistinsert_playlistSimple.htm?menuId="+menuId;break;case"recent":o="/mymusic/common/mymusiccommon_recentSongSimple.htm?menuId="+menuId;q.type="playlist";break;case"like":o="/mymusic/common/mymusiccommon_likeSongSimple.htm?menuId="+menuId;q.type="playlist";q.sort=$activeTab.find("div.song_sort>*.on").attr("data-sort");q.filter=$activeTab.find("select").val();break;case"search":if($kwd.trimVal()===""){alert("검색어를 입력해 주세요.");$kwd.focus();return}o="/mymusic/common/mymusiccommon_searchListSong.htm?menuId="+menuId;q.type="playlist";q.sort=$activeTab.find("div.song_sort>*.on").attr("data-sort");q.kwd=encodeURIComponent($kwd.trimVal());break}if(!o||o==="#"){return}isLoading=true;if(p){q.lastId=$activeTable.find(">tr:last input.d_last_id").val()}if(tabMode=="playlist"&&q.lastId>0){q.plylstSeq=$activeTable.find(">tr:last input:checkbox").val()}if(tabMode=="like"&&c("#likeSongArtist").find("option").length==1){c.ajax({url:"/mymusic/common/mymusiccommon_listSongArtist.json",data:q,dataType:"json"}).done(function(u){if(u.artistListCount>0){var v=u.artistList;var s="";var r="";for(var t=0;t<v.length;t++){s=JSON.stringify(v[t]);r=JSON.parse(s);c("#likeSongArtist").append('<option value="'+r.ARTISTID+'">'+r.ARTISTNAMEWEBLIST+"</option>")}c("select.d_selectbox").selectbox("update")}})}xhr=c.ajax({url:o,data:q,beforeSend:function(){$activeTab.find(".loading_wrap").show()}}).done(function(s){$activeTab.find(".loading_wrap").hide();if(!p){$activeTable.find(">tr:not(.d_no_data)").remove()}if(c.trim(s)===""&&$activeTable.find(">tr:not(.d_no_data)").length===0){$activeTable.find(">tr.d_no_data").show();return}else{$activeTable.find(">tr.d_no_data").hide()}$activeTable.append(s);if(tabMode=="playlist"&&$activeTable.find(">tr:last input.d_last_id").val()==20){$activeTable.html(s)}if($activeTable.find("tr").length>1){$activeTable.find("tr.d_no_data").hide()}else{$activeTable.find("tr.d_no_data").show()}if(!p){$activeTable.parent().find("thead input:checkbox").prop("checked",false);$activeTable.closest(".d_scrolldiv").animate({scrollTop:0})}var r=$activeTable.find(">tr:last input.isHasMore").val();if(r!="true"){c("button.more").hide()}else{c("button.more").show()}}).fail(function(){$activeTab.find(".loading_wrap").hide()}).always(function(){isLoading=false})}k()}});a.define("WEBSVC.MyMusic.DJCollection.IntroWriter",{maxLength:1000,init:function(){this._bindEvent()},_bindEvent:function(){var l=this,h=c("div.write_cntt"),m="textarea:not(.d_tmp_textarea)";c("div.write_cntt").on("focusin","textarea.re_text:not(.d_textcontrol)",function(){c(this).addClass("d_textcontrol").textControl({autoResize:true,counting:true,limit:1000,countType:"char",allowPaste:true})});h.on("addedlistchanged",function(p,o){c("p.text_noti strong.fc_point").text(h.find(">div.snent_insert:not(.d_textbox)").length)});var i="";var j="";var k="";c("div.wrap_btn_atach").on("click","button.btn_atach",function(p){var o=c(this);if(o.hasClass("sound")){j="artist";k="/mymusic/djcollection/mymusicdjplaylistinsert_searchArtist.htm"}else{if(o.hasClass("photo")){j="photo"}else{if(o.hasClass("video")){j="video";k="/mymusic/djcollection/mymusicdjplaylistinsert_searchMv.htm"}}}if(j!="photo"){c("#"+j+"Search").val("");c("#"+j+"View").html('<p class="search_wrong">검색된 내용이 없습니다.</p>')}else{if(MELON.WEBSVC.browser.isIE){c("#albumImage").replaceWith(c("#albumImage").clone(true))}else{c("#albumImage").val("")}}c("#selectBoxArtist").css("display","none");c("#selectBoxVideo").css("display","none");c("#artist").css("display","none");c("#photo").css("display","none");c("#video").css("display","none");c("#"+j).css("display","block");if(j!="photo"){c("#"+j+"Search").val("");c("#artistView").empty();c("#videoView").empty();c("#"+j+"View").html('<p class="search_wrong">검색된 내용이 없습니다.</p>')}else{if(MELON.WEBSVC.browser.isIE){c("#albumImage").replaceWith(c("#albumImage").clone(true))}else{c("#albumImage").val("")}}});c(".btn_b31").click(function(o){n()});c("#artistSearch").on("keyup",function(o){if(o.keyCode==13){n();return false}});c("#videoSearch").on("keyup",function(o){if(o.keyCode==13){n();return false}});function n(){var o=c("#"+j+"Search").val();if(o==""||o=="검색어를 입력해 주세요"){alert("검색어를 입력해 주세요.");c("#"+j+"Search").focus();return}c.ajax({url:k,data:{searchWord:encodeURIComponent(o)}}).done(function(p){c("#"+j+"View").empty();c("#"+j+"View").html(p)})}c("div.wrap_magazine_write").on("click","button.btn_close",function(){var o=c(this).parent().parent().attr("id");if(o!="photo"){c("#"+o+"Search").val("");c("#"+o+"View").html('<p class="search_wrong">검색된 내용이 없습니다.</p>')}else{if(MELON.WEBSVC.browser.isIE){c("#albumImage").replaceWith(c("#albumImage").clone(true))}else{c("#albumImage").val("")}}c("#"+c(this).parent().parent().attr("id")).css("display","none")});c(".btn_emphs02_small").on("click",function(){if(MELON.WEBSVC.browser.isIE){c("#albumImage").replaceWith(c("#albumImage").clone(true))}else{c("#albumImage").val("")}c("#photo").css("display","none")});c("div.wrap_magazine_write").on("click","button.btn_delt",function(){if(!confirm("삭제하시겠습니까?")){return}var o=c(this).closest("div.snent_insert");if(!o.hasClass("d_textbox")){o.next("div.d_textbox").find("textarea").textControl("destroy").end().remove()}o.remove();h.triggerHandler("addedlistchanged",["removed"]);h.find(m+":first").trigger("textcounterchange")});var g=c(".num_board");h.find(m).placeholder();function f(){var o="";h.find(m).each(function(){var p=c(this);if(p.val()==p.attr("placeholder")){return}o+=p.val()});return o.length}h.on("textcounterchange",m,function(){g.html("<strong>"+f()+"</strong> /1000자")}).on("focusin","textarea",function(){var p=c(this),o=p.textControl("instance"),q="";h.find(m).not(this).each(function(){var r=c(this);if(r.val()==r.attr("placeholder")){return}q+=r.val()});if(q.length>=1000){o.textCounter.options.limit=0}else{if(l.maxLength!=q.length){o.textCounter.options.countType="char";o.textCounter.options.limit=l.maxLength-q.length}}}).find(m+":first").trigger("textcounterchange")}})})(jQuery,MELON.WEBSVC,MELON.PBPGN);
/*!
 * @author 김승일
 * @email comahead@vi-nyl.com
 * @description 플레이리스트 관련
 */
(function(c,a,b,d){a.define("WEBSVC.MyMusic.Playlist.AddSong",function(){return{update:false,init:function(u){var q=this;var m="";c.extend(q,u);var s=c("div.chic_music_cont"),t=s.find("div.music_tab>ul").tabs({type:"parent-on"}),j=c("div.serch_frend input[type=text]"),h=c("div.serch_frend button"),r=t.find(">li.on"),i=r.find("tbody"),f=c("#d_added_table tbody"),g="recent",o=false,e={recent:0,like:0,search:0},p=s.attr("data-menuId");function l(A){var z=f.find("tr.d_added").length;if(z===0){f.find("tr.d_no_data").hide()}var y=A.removeClass("active").find("input:checkbox").prop("checked",false),B=y.val();if(f.find("input:checkbox[value="+B+"]").length>0){return}if(f.find("tr.d_added").length>=1000){alert("최대 1000곡까지 추가할 수 있습니다.");return false}var w=A.closest("tr").clone().removeClass("active").addClass("d_added");if(g==="search"){w.find("td:eq(0)").find("input:checkbox").prop("checked",false);var v=w.find("td:eq(1)").find("a").html().replace(/<B>/g,"").replace(/<\/B>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");w.find("td:eq(1)").find("a").html(v);w.find("td:eq(2)").find("div.d_layer").hideLayer();w.find("td:eq(2)").find("a").each(function(){var C=c(this).html().replace(/<B>/g,"").replace(/<\/B>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");c(this).html(C)});var x=w.find("td:eq(3)").find("a").html().replace(/<B>/g,"").replace(/<\/B>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");w.find("td:eq(3)").find("a").html(x)}else{w.find("td:eq(0)").find("input:checkbox").prop("checked",false);w.find("td:eq(2)").find("div.d_layer").hideLayer()}if(q.update){if(m==""){f.find("tr.d_no_data").after(w)}else{f.find(m).after(w)}m=w}else{f.append(w)}}function k(v){v.remove();f.trigger("addedlistchanged",["removed"])}function n(w){if(o){return}var v="",x={};switch(g){case"recent":v="/mymusic/common/mymusiccommon_recentSongSimple.htm?menuId="+p;x.type="playlist";break;case"like":v="/mymusic/common/mymusiccommon_likeSongSimple.htm?menuId="+p;x.type="playlist";x.sort=r.find("div.song_sort div.fl_right>*.on").attr("data-sort");x.filter=r.find("select").val();break;case"search":if(j.trimVal()===""){alert("검색어를 입력해 주세요.");j.focus();return}v="/mymusic/common/mymusiccommon_searchListSong.htm?menuId="+p;x.type="playlist";x.sort=r.find("div.song_sort div.fl_right>*.on").attr("data-sort");x.kwd=encodeURIComponent(j.trimVal());break}o=true;if(g=="like"&&c("#likeSongArtist").find("option").length==1){c.ajax({url:"/mymusic/common/mymusiccommon_listSongArtist.json",data:x,dataType:"json"}).done(function(B){if(B.artistListCount>0){var C=B.artistList;var z="";var y="";for(var A=0;A<C.length;A++){z=JSON.stringify(C[A]);y=JSON.parse(z);c("#likeSongArtist").append('<option value="'+y.ARTISTID+'">'+y.ARTISTNAMEWEBLIST+"</option>")}c("select.d_selectbox").selectbox("update")}})}if(!w){i.find("tr.d_item").remove();i.find("tr.d_no_data").hide();g==="search"&&i.find("tr.d_loading").show();i.parent().find("thead input:checkbox").prop("checked",false)}else{x.lastId=e[g]}c.ajax({url:v,data:x,beforeSend:function(){r.find(".loading_wrap").show()}}).done(function(y){g==="search"&&i.find("tr.d_loading").hide();if(!w){i.find("tr:not(.d_no_data)").remove()}i.append(y);if(i.find("tr").length>1){i.find("tr.d_no_data").hide()}else{i.find("tr.d_no_data").show()}if(!w){i.closest(".d_scrolldiv").animate({scrollTop:0})}lastId=0;if(i.find("tr:last input.d_last_id").val()!=d){lastId=parseInt(i.find("tr:last input.d_last_id").val());e[g]=lastId}isHasMore=i.find("tr:last input.isHasMore").val();if(isHasMore!="true"){c("button.more").hide()}else{c("button.more").show()}r.find(".loading_wrap").hide()}).fail(function(){r.find(".loading_wrap").hide()}).always(function(){o=false;g==="search"})}t.on("selected",function(w,v){r=t.find(">li:eq("+v+")");i=r.find("tbody");switch(v){case 0:g="recent";break;case 1:g="like";break;case 2:g="search";break}if(v<2){n()}else{j.trimVal("");i.html('<tr class="d_no_data"><td colspan="4" class="data_ynlk"><div class="wrap">현재 검색된 곡이 없습니다.</div></td></tr>');i.parent().find("thead input:checkbox").prop("checked",false);c("button.more").hide()}});s.on("click","tbody input:checkbox",function(w){var v=c(this);v.trigger("changed")}).on("changed","tbody input:checkbox",function(w){var v=c(this);v.closest("tr")[v.prop("checked")?"addClass":"removeClass"]("active")});j.on("keypress",function(v){if(v.keyCode===13){h.triggerHandler("click")}});h.on("click",function(){r=t.find(">li.on");r.find("div.song_sort a.on").click()});s.on("click","button.add_music, button.delt_music",function(){var w=c(this),x="",v;if(w.hasClass("disabled")){return}v=w.closest("tr");if(w.hasClass("add_music")){m="";x=v.find("input:checkbox").val();if(f.find("input:checkbox[value="+x+"]").length>0){alert("중복된 곡은 한번만 선곡됩니다.");return}l(v);f.trigger("addedlistchanged",["added"])}else{if(!confirm("해당 플레이리스트의 선택된 곡을 삭제 하시겠습니까?")){return}k(v)}});s.on("click","button.d_move_right",function(){m="";var x=i.find("input:checkbox:checked");if(x.length===0){alert("곡을 선택해 주세요.");return}var w=0;var v=0;if(f.find("tr.d_added").length===0){x.each(function(){if(l(c(this).closest("tr"))===false){return false}});f.trigger("addedlistchanged",["added"])}else{x.each(function(){w++;if(f.find("input:checkbox[value="+c(this).closest("tr").find("input:checkbox").val()+"]").length>0){v++}});if(w==v){alert("중복된 곡은 한번만 선곡됩니다.");return}else{if(v>0){if(f.find("tr.d_added").length+(w-v)>1000){alert("플레이리스트에는 최대 1,000곡까지 담기 가능합니다.\n편집모드에서 수록곡을 수정하신 후 다시 시도해주세요.");return}else{x.each(function(){if(l(c(this).closest("tr"))===false){return false}});f.trigger("addedlistchanged",["added"]);alert("이미 선택된 곡을 제외하고 추가되었습니다.")}}else{if(f.find("tr.d_added").length+w>1000){alert("플레이리스트에는 최대 1,000곡까지 담기 가능합니다.\n편집모드에서 수록곡을 수정하신 후 다시 시도해주세요.");return}else{x.each(function(){if(l(c(this).closest("tr"))===false){return false}});f.trigger("addedlistchanged",["added"])}}}}i.parent().find("thead input:checkbox").prop("checked",false)});s.on("click","button.d_remove_right",function(){var v=f.find("tr:has(input:checked)");if(v.length===0){alert("곡을 선택해 주세요.");return}if(!confirm("해당 플레이리스트의 선택된 곡을 삭제 하시겠습니까?")){return}v.remove();f.parent().find("thead input:checkbox").prop("checked",false);f.trigger("addedlistchanged",["removed"])});s.on("click","div.play_tab button.top",function(){r.find("div.song_list").animate({scrollTop:0},"fast")});s.on("click","div.play_tab button.more",function(){n(true)});s.on("click","div.chic_fin button.btn_move",function(){var w=c(this),v=f.find("tr:has(input:checked)");if(v.length===0){alert("곡을 선택해 주세요.");return}if(w.hasClass("up")){v.each(function(){var x=c(this);if(x.prev("tr:has(input:checked)").length>0){return}x.insertBefore(x.prev("tr:not(.d_no_data)"))})}else{if(w.hasClass("down")){Array.prototype.reverse.call(v).each(function(){var x=c(this);if(x.next("tr:has(input:checked)").length>0){return}x.insertAfter(x.next())})}else{if(w.hasClass("top")){f.find("tr.d_no_data").after(v)}else{if(w.hasClass("bottom")){f.append(v)}}}}f.trigger("addedlistchanged",["order"])});s.on("click","div.song_sort a",function(v){v.preventDefault();if(g==="search"&&j.trimVal()===""){alert("검색어를 입력해 주세요.");j.focus();return}c(this).activeRow("on");n()});t.on("change","#likeSongArtist",function(v){n()});f.on("addedlistchanged",function(){var v=f.find("tr.d_added").length;c("div.chic_fin>div.music_tab em").html(v);if(v>0){f.find("tr.d_no_data").hide()}else{f.find("tr.d_no_data").show();f.parent().find("thead input:checkbox").prop("checked",false)}}).triggerHandler("addedlistchanged");c("#d_ok").on("click",function(){var v=f.find("tr.d_added"),w=[];if(v.length===0){alert("선택된 곡이 없습니다.");return}v.each(function(){w.push(c(this).find("input[name=SONGID]").val())});opener.MELON.WEBSVC.PubSub.trigger("addsongs.mypage",[w]);self.close()});n()},openPopup:function(e){a.util.openPopup(e,834,640)}}})})(jQuery,MELON.WEBSVC,MELON.PBPGN);$(function(){var a=MELON.WEBSVC;MELON.WEBSVC.DJCollection.init();var b=null;$(document).on("beforeshow.dropdown","div.userlk06",function(h){var d=$(this),f=d.data("opener"),c="",g="";if(f.attr("data-song-no")){g=f.attr("data-song-no");c="song"}else{if(f.attr("data-album-no")){g=f.attr("data-album-no");c="album"}else{if(f.attr("data-mv-no")){g=f.attr("data-mv-no");c="video"}else{if(f.attr("data-play-seq")){g=f.attr("data-play-seq");c="playlist"}else{if(f.attr("data-user-ids")){g=f.attr("data-user-ids");meYn=f.attr("me-yn");c="listenedFriend"}else{if(f.attr("data-manysong-no")){g=f.attr("data-manysong-no");searchDate=f.attr("data-search-date");c="listenedFriendManySong"}else{if(f.attr("data-djplay-seq")){g=f.attr("data-djplay-seq");c="djPlaylist"}else{if(f.attr("data-artistplay-seq")){g=f.attr("data-artistplay-seq");c="artistPlaylist"}else{h.preventDefault();return}}}}}}}}d.data("isLoaded",true);if(!g){alert("버튼에 data-[type]-no 속성을 넣어주세요.");h.preventDefault();return}d.find(">span:last").css("left",Math.abs(parseInt(d.css("left"),10)-f.position().left-f.width()+14));d.find("div.box_scroll").css({textAlign:"center",lineHeight:"352px"}).html("조회 중입니다...");b&&b.abort();if(c=="listenedFriend"){b=$.ajax({url:"/mymusic/friend/mymusicfriendmusicchart_listListenedFriend.htm",data:{userIds:g,mymusicChk:meYn}}).done(function(e){d.find("div.box_scroll").css({textAlign:"",lineHeight:""}).html(e)})}else{if(c=="listenedFriendManySong"){b=$.ajax({url:"/mymusic/top/mymusictopmanysong_listListenedFriend.htm",data:{songId:g,searchDate:searchDate}}).done(function(e){d.find("div.box_scroll").css({textAlign:"",lineHeight:""}).html(e)})}else{b=$.ajax({url:"/mymusic/common/mymusiccommon_listUserWithLike.htm",data:{contsId:g,type:c}}).done(function(e){d.find("div.box_scroll").css({textAlign:"",lineHeight:""}).html(e)})}}});$("div.wrap_baner").on("click",".btn_close",function(){$(this).parent().hide()})});(function(){MELON.WEBSVC.POC.MYMUSIC={deleteMultiLike:function(b,e,f){if(!MELON.WEBSVC.POC.login.isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd("");return}var d="";var c=0;if(b=="song"){d="곡을"}else{if(b=="album"){d="앨범을"}else{if(b=="video"){d="영상을"}else{if(b=="photo"){d="포토를"}else{if(b=="playlist"){d="플레이리스트를"}else{if(b=="djplaylist"){d="DJ플레이리스트를"}else{if(b=="partnerplaylist"){d="아티스트 플레이리스트를"}}}}}}}var a=new Array();$("#"+e).find(".input_check:checked").each(function(){if(!isNaN($(this).val())){a.push($(this).val());c++}});if(a==""){alert(d+" 선택해 주세요.");return}if(f==""){alert("메뉴아이디가 존재하지 않습니다.");return}MELON.WEBSVC.confirm2('<div class="fc_strong" style="width:225px;">'+c+"개의 "+d+" 좋아요 취소 하시겠습니까?</div>").on("ok",function(){$.ajax({url:"/mymusic/common/mymusiccommon_deleteMultiLike.json",type:"POST",data:{contsIds:a,type:b,menuId:f},success:function(g){if(g.result===true){if(b=="video"){b="mv"}MELON.WEBSVC.alert2("좋아요 취소되었습니다.",{opener:$(this),removeOnClose:true});mymusic.getAjaxLikeList(g.memberKey,b)}else{alert(g.errorMessage);if(g.tockenValid!=undefined&&g.tockenValid==false){var i=MELON.WEBSVC.POC.getPocId();if("WP42"==i){try{MelonAPI.window("forceLogout","")}catch(h){}}else{location.href=g.returnUrl}}return}}})})},listUserWithLike:function(a,b,c){$.ajax({url:"/mymusic/common/mymusiccommon_listUserWithLike.htm",data:{contsId:a,type:b}}).done(function(d){c.find("div.box_scroll").css({textAlign:"",lineHeight:""}).html(d)})},getAjaxFbIsConnect:function(a){$.getJSON("/mymusic/friend/mymusicfriendfacebook_informFb.json",function(b){if(b.ISCONNECTED==true){mymusic.getAjaxFbFriend(a,b.ISHOMETAB)}else{if(confirm("페이스북 계정 연결 후\n자동으로 친구를 추가하세요.\n계정연결 하시겠습니까?")){mymusic.popFBConnect(b.ISHOMETAB)}}})},getHeight:function(){return document.documentElement.clientHeight/3},getWidth:function(){return document.documentElement.clientWidth/3},popFBConnect:function(c){var b="N";if(c==true){b="Y"}var a="https://member.melon.com/muid/web/sns/sns_inform.htm?homeTab="+b;MELON.WEBSVC.openPopup(a,834,640)},getAjaxFbFriend:function(a,b){var c=Number($("#totFbFriendCnt").val());var d=1;$.getJSON("/mymusic/friend/mymusicfriendfacebook_list.json",{memberKey:a,startIndex:d},function(e){if(e.resultStatus==false){if(e.resultStatusCode=="1001"||e.resultStatusCode=="1002"||e.resultStatusCode=="1003"||e.resultStatusCode=="-3"){alert("Facebook 계정연결의\n유효기간이 만료되었습니다.\nSNS 계정연결에서 계정해제 후 다시 연결해주세요.")}else{if(e.resultStatusCode=="1004"||e.resultStatusCode=="1100"){alert("죄송합니다.\n잠시 후 다시 시도해주세요.")}else{if(e.resultStatusCode=="1005"){alert("페이스북 권한 오류가 발생하여 친구목록을 불러올 수 없습니다.\n페이스북 계정 재연결 후 사용해 주세요.")}}}return false}else{if(e.resultStatusCode=="0001"){if(confirm(e.MESSAGE)){mymusic.getAjaxFbFriend(a,e.ISHOMETAB)}}else{alert(e.MESSAGE);return false}}})},getAjaxFbFriendPaging:function(b){var d=Number($("#totFbFriendCntNew").val());var a=Number(d+1);var e=1;var c=false;$.getJSON("/mymusic/friend/mymusicfriendfacebook_listPaging.json",{pageIndex:a,memberKey:b},function(l){if(l.resultStatus==false){var g=getCookie("MPS");var k="MELONPLAYER";if(g!=null&&g.match("^"+k)==k){c=true}if(l.resultStatusCode=="1001"||l.resultStatusCode=="1002"||l.resultStatusCode=="1003"||l.resultStatusCode=="-3"){mymusic.showPopFbFriendReconnect(c)}else{if(l.resultStatusCode=="1004"||l.resultStatusCode=="1100"){mymusic.showPopFbFriendConnectionFail(c)}else{if(l.resultStatusCode=="1005"){mymusic.showPopFbFriendAuthFail(c)}}}}else{e=d+l.fbFriendCnt;var h="친구를 모두 불러왔습니다.";var i="";if(l.hasMore==true){h="친구 <strong>"+mymusic.numberComma(e)+"<span>명</span></strong>을 불러왔습니다."}else{$("#fbFriendMoreBtn").hide()}if(l.fbFriendCnt>0){for(var j=0;j<l.fbFriendCnt;j++){var f=l.fbFriendList;if(f[j].ISMYFRIEND==true){i=i+'<li><dl><dt><input type="checkbox" class="input_check" title="'+f[j].DISPLAYNAME+'- 선택" disabled="disabled" /></dt><dd class="img"><img src="https://graph.facebook.com/'+f[j].PROVIDERUSERID+'/picture?width=40&height=40" width="40" height="40" alt="'+f[j].DISPLAYNAME+'"/></dd><dd class="name disabled">'+f[j].DISPLAYNAME+'</dd><dd class="bar"><span class="ico_already"><span class="none">이미 친구에요</span></span></dd><dd class="btn"><button type="button" class="btn_base02 disabled" title="'+f[j].DISPLAYNAME+' - 초대" disabled="disabled"><span class="odd_span"><span class="even_span">초대</span></span></button></dd></dl></li>'}else{if((f[j].ISMELONUSER==true)){i=i+'<li><dl><dt><input type="checkbox" class="input_check" title="'+f[j].DISPLAYNAME+' - 선택" name="friendId" id="check_'+f[j].PROVIDERUSERID+'" value="'+f[j].PROVIDERUSERID+'" value2 ="'+f[j].MEMBERKEY+'"/></dt><dd class="img"><img src="https://graph.facebook.com/'+f[j].PROVIDERUSERID+'/picture?width=40&height=40" width="40" height="40" alt="'+f[j].DISPLAYNAME+'"/></dd><dd class="name">'+f[j].DISPLAYNAME+'</dd><dd class="bar"><span class="ico_ifs"><span class="none">계정 연동중</span></span></dd><dd class="btn"><button type="button" class="btn_base02" title="'+f[j].DISPLAYNAME+" - 초대\" onclick=\"javascript:inviteFriend('friendId', '"+f[j].PROVIDERUSERID+"',"+f[j].MEMBERKEY+');"><span class="odd_span"><span class="even_span">초대</span></span></button></dd></dl></li>'}else{i=i+'<li><dl><dt><input type="checkbox" class="input_check" title="'+f[j].DISPLAYNAME+' - 선택" name="inviteId" id="check_'+f[j].PROVIDERUSERID+'" value="'+f[j].PROVIDERUSERID+'" value2 ="'+f[j].DISPLAYNAME+'"/></dt><dd class="img"><img src="https://graph.facebook.com/'+f[j].PROVIDERUSERID+'/picture?width=40&height=40" width="40" height="40" alt="'+f[j].DISPLAYNAME+'"/></dd><dd class="name">'+f[j].DISPLAYNAME+'</dd><dd class="btn"><button type="button" class="btn_base02" title="'+f[j].DISPLAYNAME+" - 초대\" onclick=\"javascript:inviteFriend('inviteId','"+f[j].PROVIDERUSERID+"','"+f[j].DISPLAYNAME+'\');"><span class="odd_span"><span class="even_span">초대</span></span></button></dd></dl></li>'}}}}$("#fbFriendCnt").html(h);$("#totFbFriendCntNew").val(e);$("#fbFriendListPaging").append(i)}})},closeFbFriend:function(){$(".fbFriendContainer").hide();$("#totFbFriendCnt").val("0");getAjaxRightPage("myFriend")},reinvitedFriend:function(d,f,b,e,a,h){var g="";var c="";if(d){g=g+d}if(f){if(g){g=g+","+f}else{g=g+f}}if(g==""){MELON.WEBSVC.alert('<p class="facebook_pop"><strong>선택한 친구가 없습니다!<br>초대할 친구를 선택해주세요.</strong></p>',{title:"Facebook 친구초대"});return false}$.getJSON("/mymusic/friend/mymusicfriendfacebook_informFb.json",function(i){if(i.ISCONNECTED==true){c=i.PROVCUSERID}mymusic.snsFacebookRequest(g,d,f,b,e,a,h,c)})},invitedFriend:function(d,f,b,e,a,h){var g="";var c="";if(d){g=g+d}if(f){if(g){g=g+","+f}else{g=g+f}}if(g==""){MELON.WEBSVC.alert('<p class="facebook_pop"><strong>선택한 친구가 없습니다!<br>초대할 친구를 선택해주세요.</strong></p>',{title:"Facebook 친구초대"});return false}$.getJSON("/mymusic/friend/mymusicfriendfacebook_informFb.json",function(i){if(i.ISCONNECTED==true){c=i.PROVCUSERID}mymusic.snsFacebookRequest(g,d,f,b,e,a,h,c)})},snsFacebookRequest:function(g,a,b,i,c,f,h,j){var k="멜론에서 친구가 만든 플레이리스트 및 다양한 음악을 나눠보세요. 더욱 즐겁게 음악과 함께 할 수 있습니다. 음악이 필요한 순간, 멜론";var e="www.melon.com";var d="";if(g){d=d+g}FB.getLoginStatus(function(l){if(l.status==="connected"){var n=l.authResponse.userID;var m=l.authResponse.accessToken;if(j==n){FB.ui({method:"apprequests",message:k,to:d},function(o){if(o&&!o.error_code){mymusic.doInviteFbFriend(d,a,b,i,c,f,h)}})}else{if(j!=""&&j!=n){alert("현재 자동로그인 설정된 페이스북 계정이\r\n멜론에 계정연결된 페이스북 계정과 다릅니다.\r\n멜론에 계정연결된 페이스북 계정으로 로그인후 다시 시도해주세요.");return false}else{mymusic.getAjaxFbIsConnect(f)}}}else{if(l.status==="not_authorized"){mymusic.getAjaxFbIsConnect(f)}else{FB.ui({method:"apprequests",message:k,to:d},function(o){if(o&&!o.error_code){mymusic.doInviteFbFriend(d,a,b,i,c,f,h)}})}}})},doInviteFbFriend:function(f,c,e,b,d,a,g){$.getJSON("/mymusic/friend/mymusicfriendfacebook_insertFbFriend.json",{user_ids:f,inviteNameResult:b,friendMemberKeyResult:d,memberKey:a,menuId:g},function(h){if(h.invitedResult=="1"||h.invitedResult=="2"){if(h.toCnt>50){MELON.WEBSVC.alert('<p class="facebook_pop"><strong>초대요청인원 <span>'+numberComma(h.toCnt)+'</span>명!<br>초대인원이 초과되었습니다.</strong><span class="text_type">초대하기는 50명까지만 가능합니다.</span></p>',{title:"Facebook 친구초대"})}else{if(h.toCnt<=50){MELON.WEBSVC.alert('<p class="facebook_pop"><strong>Facebook 친구에게 초대알림을 보냈습니다.</strong></p>',{title:"Facebook 친구초대"})}}if(g!="56020202"&&g!="56020201"){mymusic.getAjaxFbFriend(a)}return false}else{MELON.WEBSVC.alert('<p class="facebook_pop"><strong>죄송합니다.<br>잠시 후 다시 시도해주세요.</strong></p>',{title:"Facebook 친구초대"});return false}})},showPopFbFriendReconnect:function(a){MELON.WEBSVC.alert('<p class="facebook_pop"><strong>Facebook 계정연결의<br>유효기간이 만료되었습니다.</strong><span class="text_type">SNS 계정연결에서 계정해제 후 다시 연결해주세요.</span></p>',{title:"Facebook 계정연결"});return false},showPopFbFriendConnectionFail:function(a){MELON.WEBSVC.alert('<p class="facebook_pop"><strong>죄송합니다.<br>잠시 후 다시 시도해주세요.</strong></p>',{title:"Facebook 계정연결"});return false},showPopFbFriendAuthFail:function(a){MELON.WEBSVC.alert('<p class="facebook_pop"><strong>페이스북 권한 오류가 발생하여 친구목록을 불러올 수 없습니다.<br>페이스북 계정 재연결 후 사용해 주세요.</strong></p>',{title:"Facebook 계정연결"});return false},numberComma:function(b){if(isNaN(b)){return}var a=new RegExp("(-?[0-9]+)([0-9]{3})");while(a.test(b)){b=b.replace(a,"$1,$2")}return b},friendSearch:function(){var a=$("#friend").trimVal();if(a==""||a=="멜론회원을 검색해 주세요"){alert("검색어를 입력해 주세요.");$("#friend").focus();return}else{if(a.length==1){alert("멜론 친구 닉네임은 두 글자 이상만 검색 가능합니다.");$("#friend").focus();return}}location.href="/mymusic/friend/mymusicfriend_listSearch.htm?searchKeyword="+encodeURIComponent(encodeURIComponent(a))},friendSearchKey:function(a){if(a.keyCode==13){MELON.WEBSVC.POC.MYMUSIC.friendSearch();return false}},getAjaxLikeList:function(a,c){var b="";if(c=="song"){href="/mymusic/like/mymusiclikesong_listAjax.htm"}else{if(c=="album"){href="/mymusic/like/mymusiclikealbum_listAjax.htm"}else{if(c=="mv"){href="/mymusic/like/mymusiclikemv_listAjax.htm"}else{if(c=="photo"){href="/mymusic/like/mymusiclikephoto_listAjax.htm"}else{if(c=="playlist"){href="/mymusic/like/mymusiclikeplaylist_listAjax.htm"}else{if(c=="djplaylist"){href="/mymusic/like/mymusiclikedjplaylist_listAjax.htm"}else{if(c=="partnerplaylist"){href="/mymusic/like/mymusiclikeartistplaylist_listAjax.htm"}}}}}}}$.ajax({url:href,data:{memberKey:a},async:false}).done(function(d){$("#likeList").empty();$("#likeList").html(d);$(".d_selectbox").selectbox()})},getAjaxPlayList:function(a){$.ajax({url:"/mymusic/playlist/mymusicplaylist_listAjax.htm",data:{memberKey:a},async:false}).done(function(b){$("#playlistList").empty();$("#playlistList").html(b)})},getAjaxArtistFanList:function(a){$.ajax({url:"/mymusic/artistfan/mymusicartistfan_listAjax.htm",data:{memberKey:a},async:false}).done(function(b){$("#artistFanList").empty();$("#artistFanList").html(b)})},getPhotoDeatil:function(a,b,d,c){if(!MELON.WEBSVC.POC.login.isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd("");return}if(typeof a=="undefined"||a<1){alert("정상적인 접근이 아닙니다.");location.href="//www.melon.com";return}$.ajax({type:"POST",url:"/mymusic/common/mymusiccommon_informPhotoPrivtAuth.json",async:false,data:{memberKey:a,photoId:b},success:function(e){if(e.privtAuth=="N"){alert("맺은팬 전용 콘텐츠 입니다.");return}else{$.ajax({url:"/mymusic/like/mymusiclikephoto_inform.htm",data:{memberKey:a,photoId:b,orderBy:d,paramArtistId:c},async:false}).done(function(f){$("#likeList").empty();$("#likeList").html(f)})}}})},popupAutoResize:function(){window.resizeTo(100,100);var d=parseInt(document.body.scrollWidth);var b=parseInt(document.body.scrollHeight);var e=screen.width-50;var c=screen.height-50;var a=0;if(navigator.userAgent.indexOf("MSIE 6")>0){a=60}else{if(navigator.userAgent.indexOf("MSIE 7")>0){a=80}else{if(navigator.userAgent.indexOf("Firefox")>0){a=50}else{if(navigator.userAgent.indexOf("Opera")>0){a=30}else{if(navigator.userAgent.indexOf("Netscape")>0){a=-2}else{if(navigator.userAgent.indexOf("Chrome")>0){a=20}else{a=80}}}}}}if(d>e){window.document.body.scroll="yes";d=e}if(b>c-a){window.document.body.scroll="yes";d+=19;b=c-a}window.resizeTo(d+10,b+a)},saveWiseLog:function(b,a){var d=getMemberKey()==""?0:getMemberKey();var c="";var e="my";if(a!=d){e="other"}b=b.replace("http://www.melon.com/mymusic/","");b=b.replace("https://www.melon.com/mymusic/","");b=b.split(".htm")[0];c="/mymusic/common/"+e+"/"+b+".json?memberKey="+a;$.ajax({type:"GET",url:c})},mymusicLink:{goFriend:function(a){if(typeof a=="undefined"){return}window.open("/mymusic/friend/mymusicfriend_list.htm?memberKey="+a)},goMyFriend:function(a){if(typeof a=="undefined"){return}location.href="/mymusic/friend/mymusicfriend_list.htm?memberKey="+a},goFriendMusicChart:function(a){if(typeof a=="undefined"){return}location.href="/mymusic/friend/mymusicfriendmusicchart_list.htm?memberKey="+a},goRecmFriend:function(a){if(typeof a=="undefined"){return}location.href="/mymusic/friend/mymusicfriendrecm_list.htm?memberKey="+a},goFriendAddsMe:function(a){if(typeof a=="undefined"){return}location.href="/mymusic/friend/mymusicfriendaddsme_list.htm?memberKey="+a},goFriendInvited:function(a){if(typeof a=="undefined"){return}location.href="/mymusic/friend/mymusicfriendinvited_list.htm?memberKey="+a},goFriendFacebook:function(a){if(typeof a=="undefined"){return}location.href="/mymusic/friend/mymusicfriendfacebook_list.htm?memberKey="+a},goLikeSong:function(a){if(typeof a=="undefined"){return}location.href="/mymusic/like/mymusiclikesong_list.htm?memberKey="+a},goLikeAlbum:function(a){if(typeof a=="undefined"){return}location.href="/mymusic/like/mymusiclikealbum_list.htm?memberKey="+a},goLikeMv:function(a){if(typeof a=="undefined"){return}location.href="/mymusic/like/mymusiclikemv_list.htm?memberKey="+a},goLikePlaylist:function(a){if(typeof a=="undefined"){return}location.href="/mymusic/like/mymusiclikeplaylist_list.htm?memberKey="+a},goLikeArtistPlaylist:function(a){if(typeof a=="undefined"){return}location.href="/mymusic/like/mymusiclikeartistplaylist_list.htm?memberKey="+a},goLikeDjPlaylist:function(a,b){if(typeof a=="undefined"){return}var c="";if(b!=""){c="&flag="+b}location.href="/mymusic/like/mymusiclikedjplaylist_list.htm?memberKey="+a+c},goLikePhoto:function(a){if(typeof a=="undefined"){return}location.href="/mymusic/like/mymusiclikephoto_list.htm?memberKey="+a},goPlaylistDetail:function(a,c,d,b){if(c=="N"){alert("비공개된 컨텐츠 입니다.");return}if(d=="Y"){alert("삭제된 컨텐츠 입니다.");return}location.href="/mymusic/playlist/mymusicplaylistview_inform.htm?plylstSeq="+b},goMyPlaylistDetail:function(a){location.href="/mymusic/playlist/mymusicplaylistview_inform.htm?plylstSeq="+a},goDjPlaylistDetail:function(a,b,d,c){if(b=="N"){alert("비공개된 컨텐츠 입니다.");return}if(d=="Y"){alert("삭제된 컨텐츠 입니다.");return}location.href="/mymusic/dj/mymusicdjplaylistview_inform.htm?plylstSeq="+c},goMyDjPlaylistDetail:function(a){location.href="/mymusic/dj/mymusicdjplaylistview_inform.htm?plylstSeq="+a},goMyPage:function(a){if(typeof a=="undefined"||a<1){alert("정상적인 접근이 아닙니다.");location.href="//www.melon.com";return}location.href="/mymusic/main/mymusicmain_list.htm?memberKey="+a},goMyPageOther:function(a){if(typeof a=="undefined"||a<1){alert("정상적인 접근이 아닙니다.");location.href="//www.melon.com";return}location.href="/mymusic/main/mymusicmainother_list.htm?memberKey="+a},goInsertPresent:function(){location.href="/mymusic/messagepresent/mymusicpresent_insert.htm"},goDjPlaylistList:function(a){location.href="/mymusic/dj/mymusicdjplaylist_list.htm?memberKey="+a},goDjplaylistInsert:function(a){$.ajax({url:"/mymusic/common/mymusiccommon_plylstCount.json",data:{plylstTypeCode:"M20002"},async:false,success:function(b){if(b.result>0){var c="/mymusic/dj/mymusicdjplaylistinsert_insert.htm";if(typeof a!="undefined"&&a!=""){c=c+"?plylstSeq="+a}location.href=c}else{if(b.result==-309){alert("DJ플레이리스트는 최대 500개까지 만드실 수 있습니다.");return}}}})},goDjplaylistInsert:function(a,b){$.ajax({url:"/mymusic/common/mymusiccommon_plylstCount.json",data:{plylstTypeCode:"M20002"},async:false,success:function(c){if(c.result>0){var d="/mymusic/dj/mymusicdjplaylistinsert_insert.htm";if(typeof a!="undefined"&&a!=""){d=d+"?plylstSeq="+a+"&menuId="+b}location.href=d}else{if(c.result==-309){alert("DJ플레이리스트는 최대 500개까지 만드실 수 있습니다.");return}}}})},goDjPlaylistManage:function(){location.href="/mymusic/dj/mymusicdjplaylistmanage_list.htm"},goDjplaylistUpdate:function(a){if(typeof a=="undefined"||a==""){alert("DJ플레이리스트 번호가 없습니다.");return}location.href="/mymusic/dj/mymusicdjplaylistupdate_inform.htm?plylstSeq="+a},goPlaylistList:function(a){location.href="/mymusic/playlist/mymusicplaylist_list.htm?memberKey="+a},goPlaylistInsert:function(){$.ajax({url:"/mymusic/common/mymusiccommon_plylstCount.json",data:{plylstTypeCode:"M20001"},async:false,success:function(a){if(a.result>0){location.href="/mymusic/playlist/mymusicplaylistinsert_insert.htm"}else{if(a.result==-309){alert("플레이리스트는 최대 500개까지 만드실 수 있습니다.");return}}}})},goPlaylistManage:function(){location.href="/mymusic/playlist/mymusicplaylistmanage_list.htm"},goPlaylistUpdate:function(a){if(typeof a=="undefined"||a==""){alert("플레이리스트 번호가 없습니다.");return}location.href="/mymusic/playlist/mymusicplaylistupdate_inform.htm?plylstSeq="+a},goRecentSong:function(a){if(!MELON.WEBSVC.POC.login.isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd("");return}location.href="/mymusic/recent/mymusicrecentsong_list.htm?memberKey="+a},goRecentMv:function(a){if(!MELON.WEBSVC.POC.login.isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd("");return}location.href="/mymusic/recent/mymusicrecentmv_list.htm?memberKey="+a},goRecentSmartRadio:function(a){location.href="/mymusic/recent/mymusicrecentsmartradio_list.htm?memberKey="+a},goManySong:function(a,b){if(!MELON.WEBSVC.POC.login.isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd("");return}if(typeof b!="undefined"){location.href="/mymusic/top/mymusictopmanysong_list.htm?memberKey="+a+"&dateType="+b;return}location.href="/mymusic/top/mymusictopmanysong_list.htm?memberKey="+a},goMyPageSetting:function(){location.href="/mymusic/setting/mymusicsetting_informProfile.htm"},goUpdateMyInfo:function(a){if(typeof a=="undefined"||a<1){alert("정상적인 접근이 아닙니다.");window.location="//www.melon.com";return}location.href="https://member.melon.com/muid/web/update/memberinfomationupdateform_inform.htm"},goUsageHistory:function(a){if(typeof a=="undefined"||a<1){alert("정상적인 접근이 아닙니다.");window.location="//www.melon.com";return}window.location="//www.melon.com/commerce/mypage/product/web/producthistory_listCurUserProdView.htm"},goFanArtist:function(a){location.href="/mymusic/artistfan/mymusicartistfan_list.htm?memberKey="+a},goPresentSong:function(a){location.href="/mymusic/messagepresent/mymusicpresent_list.htm"},goRePresentSong:function(a,b){if(typeof a=="undefined"||a<1){alert("정상적인 접근이 아닙니다.");window.location="//www.melon.com";return}if(!MELON.WEBSVC.POC.login.isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd("");return}$.get("/mymusic/friend/mymusicfriend_listFriendMemberStatus.json",{memberkey:a},function(c){}).done(function(f){if(f.MEMBERSTATUS!="0"){alert("탈퇴한 회원입니다.");return}else{params={targetMemK:a,targetMemN:f.MEMBERNICKNAME,rePresent:"Y",menuId:b};method="POST";var e=document.createElement("form");e.setAttribute("method",method);e.setAttribute("action","/mymusic/messagepresent/mymusicpresent_insert.htm");for(var d in params){var c=document.createElement("input");c.setAttribute("type","hidden");c.setAttribute("name",d);c.setAttribute("value",params[d]);e.appendChild(c)}document.body.appendChild(e);e.submit()}})},goMain:function(b,a){if(b==1){alert("탈퇴한 회원 입니다.");return}if(b==2){alert("휴면 회원 입니다.");return}if(b==""||a==-1){alert("존재하지 않는 회원입니다.");return}if(a==-99){return}if(typeof a=="undefined"||a<1){alert("정상적인 접근이 아닙니다.");window.location="//www.melon.com";return}location.href="/mymusic/main/mymusicmainother_list.htm?memberKey="+a},goMessage:function(a){location.href="/mymusic/messagepresent/mymusicmessage_list.htm"},goReturnMessage:function(b,c){if(typeof b=="undefined"||b<1){alert("정상적인 접근이 아닙니다.");window.location="//www.melon.com";return}if(!MELON.WEBSVC.POC.login.isMelonLogin()){MELON.WEBSVC.POC.login.loginPopupLayerd("");return}var a=navigator.userAgent.toLocaleLowerCase();$.get("/mymusic/friend/mymusicfriend_listFriendMemberStatus.json",{memberkey:b},function(d){}).done(function(g){if(g.MEMBERSTATUS!="0"){alert("탈퇴한 회원입니다.");return}else{params={targetMemK:b,targetMemN:g.MEMBERNICKNAME,reMessage:"Y",menuId:c};method="POST";var f=document.createElement("form");f.setAttribute("method",method);f.setAttribute("action","/mymusic/messagepresent/popup/mymusicmessage_insertForm.htm");for(var e in params){var d=document.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name",e);d.setAttribute("value",params[e]);f.appendChild(d)}document.body.appendChild(f);if(a.indexOf("safari")>-1||a.indexOf("IS40")>-1){MELON.WEBSVC.openPopup("",730,750,{target:"pop",scrollbars:"no"},"center","pop")}else{MELON.WEBSVC.openPopup("",730,738,{target:"pop",scrollbars:"no"},"center","pop")}f.setAttribute("target","pop");f.submit()}})},goMainNew:function(b,a){if(b==1){alert("탈퇴한 회원입니다.");return}if(b==2){alert("휴면 회원입니다.");return}if(b==""||a==-1){alert("탈퇴한 회원입니다.");return}if(typeof a=="undefined"||a<1){alert("정상적인 접근이 아닙니다.");window.location="//www.melon.com";return}window.open("/mymusic/main/mymusicmainother_list.htm?memberKey="+a)},goMessagePop:function(c){var a=navigator.userAgent.toLocaleLowerCase();var b=738;if(a.indexOf("safari")>-1||a.indexOf("IS40")>-1){b=750}if(typeof c=="undefined"){MELON.WEBSVC.openPopup("/mymusic/messagepresent/popup/mymusicmessage_insertForm.htm",730,b,{scrollbars:"no"},"center","mespop")}else{MELON.WEBSVC.openPopup("/mymusic/messagepresent/popup/mymusicmessage_insertForm.htm?menuId="+c,730,b,{scrollbars:"no"},"center","mespop")}},goMultiMessagePop:function(c,a,d){var b=0;if(c=="song"){b=456}else{if(c=="album"){b=456}else{if(c=="artist"){b=456}else{if(c=="mv"){b=460}else{if(c=="plylst"){b=466}else{if(c=="djcol"){b=466}else{if(c=="artistplylst"){b=466}else{if(c=="photo"){b=546}}}}}}}}if(typeof d=="undefined"){MELON.WEBSVC.openPopup("/mymusic/messagepresent/popup/mymusicmessage_insertMultiForm.htm?contsType="+c+"&contsId="+a,730,b,{scrollbars:"no"},"center","multipop")}else{MELON.WEBSVC.openPopup("/mymusic/messagepresent/popup/mymusicmessage_insertMultiForm.htm?contsType="+c+"&menuId="+d+"&contsId="+a,730,b,{scrollbars:"no"},"center","multipop")}},goPlaylistDetailNew:function(a,c,d,b){if(c=="N"){alert("비공개된 컨텐츠 입니다.");return}if(d=="Y"){alert("삭제된 컨텐츠 입니다.");return}window.open("/mymusic/playlist/mymusicplaylistview_inform.htm?plylstSeq="+b)},goDjPlaylistDetailNew:function(a,b,d,c){if(b=="N"){alert("비공개된 컨텐츠 입니다.");return}if(d=="Y"){alert("삭제된 컨텐츠 입니다.");return}window.open("/mymusic/dj/mymusicdjplaylistview_inform.htm?plylstSeq="+c)},goMyPageOtherNew:function(a){if(typeof a=="undefined"||a<1){alert("정상적인 접근이 아닙니다.");location.href="//www.melon.com";return}window.open("/mymusic/main/mymusicmainother_list.htm?memberKey="+a)},goMagazineEpsd:function(a){if(typeof a=="undefined"){alert("DJ매거진SEQ가 없습니다.");return}location.href="/dj/magazine/djmagazinedetail_listEpsd.htm?magaznSeq="+a},goMyCommerce:function(){location.href="/cm/record/listSongMp3DlRecrdView.htm"},goArtistPlaylistDetail:function(b,a){if(b=="N"){alert("비공개된 컨텐츠입니다.");return}if(typeof a=="undefined"){return}location.href="/artist/playlistDetail.htm?plylstSeq="+a}}}})();var mymusic=MELON.WEBSVC.POC.MYMUSIC;/* melonweb_mymusic_custom.js */